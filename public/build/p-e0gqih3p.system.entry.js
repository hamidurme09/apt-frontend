var __awaiter=this&&this.__awaiter||function(t,e,s,n){function r(t){return t instanceof s?t:new s((function(e){e(t)}))}return new(s||(s=Promise))((function(s,i){function a(t){try{c(n.next(t))}catch(t){i(t)}}function o(t){try{c(n["throw"](t))}catch(t){i(t)}}function c(t){t.done?s(t.value):r(t.value).then(a,o)}c((n=n.apply(t,e||[])).next())}))};var __generator=this&&this.__generator||function(t,e){var s={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,r,i,a;return a={next:o(0),throw:o(1),return:o(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(t){return function(e){return c([t,e])}}function c(a){if(n)throw new TypeError("Generator is already executing.");while(s)try{if(n=1,r&&(i=a[0]&2?r["return"]:a[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;if(r=0,i)a=[a[0]&2,i.value];switch(a[0]){case 0:case 1:i=a;break;case 4:s.label++;return{value:a[1],done:false};case 5:s.label++;r=a[1];a=[0];continue;case 7:a=s.ops.pop();s.trys.pop();continue;default:if(!(i=s.trys,i=i.length>0&&i[i.length-1])&&(a[0]===6||a[0]===2)){s=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(a[0]===6&&s.label<i[1]){s.label=i[1];i=a;break}if(i&&s.label<i[2]){s.label=i[2];s.ops.push(a);break}if(i[2])s.ops.pop();s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t];r=0}finally{n=i=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var __spreadArrays=this&&this.__spreadArrays||function(){for(var t=0,e=0,s=arguments.length;e<s;e++)t+=arguments[e].length;for(var n=Array(t),r=0,e=0;e<s;e++)for(var i=arguments[e],a=0,o=i.length;a<o;a++,r++)n[r]=i[a];return n};System.register(["./p-c9001ae9.system.js","./p-69f5d316.system.js","./p-32fd337e.system.js","./p-50f9a219.system.js","./p-57233c53.system.js","./p-a55517c8.system.js","./p-de762d09.system.js","./p-5ad401ce.system.js","./p-2a28951d.system.js","./p-94e7dad5.system.js","./p-88563aa0.system.js","./p-905fd021.system.js","./p-86739eb0.system.js","./p-5927ec0e.system.js"],(function(t){"use strict";var e,s,n,r,i,a,o,c,l,u,d,h,f,p,g;return{setters:[function(t){e=t.r;s=t.c;n=t.h;r=t.d},function(){},function(){},function(){},function(t){i=t.a},function(t){a=t.R},function(t){o=t.D},function(t){c=t.f;l=t.a},function(t){u=t.T},function(t){d=t.A},function(t){h=t.t},function(t){f=t.s},function(t){p=t.A},function(t){g=t.A}],execute:function(){var m=undefined&&undefined.__decorate||function(t,e,s,n){var r=arguments.length,i=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,s):n,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")i=Reflect.decorate(t,e,s,n);else for(var o=t.length-1;o>=0;o--)if(a=t[o])i=(r<3?a(i):r>3?a(e,s,i):a(e,s))||i;return r>3&&i&&Object.defineProperty(e,s,i),i};var y=t("page_admin_listings",function(){function t(t){e(this,t);this.isAdmin=false;this.isLoggedIn=false;this.pageSize=40;this.loaded=false;this.listings=[];this.searchParams={sortBy:"webid_asc",price_month:0,active:"all",search_type:"webid",search_query:"",offset:0,limit:this.pageSize};this.resultCount=0;this.activeCount=0;this.inactiveCount=0;this.formFocus=null;this.store=s(this,"store")}t.prototype.componentWillLoad=function(){this.store.mapStateToProps(this,(function(t){return{isLoggedIn:i.isLoggedIn(t),isAdmin:i.isAdmin(t),bedroomTypes:h.getBedroomTypes(t),buildingTypes:h.getBuildingTypes(t),screenHeight:f.getHeight(t)}}));if(!this.isLoggedIn){a.forward("/login")}else{if(!this.isAdmin){a.forward("/")}}};t.prototype.componentDidLoad=function(){this.renderListings()};t.prototype.componentDidRender=function(){var t=this;requestAnimationFrame((function(){if(t.listingsWrapper){t.listingsWrapper.style.maxHeight=t.getTableHeight()}}))};t.prototype.renderListings=function(){return __awaiter(this,void 0,void 0,(function(){var t,e;return __generator(this,(function(s){switch(s.label){case 0:s.trys.push([0,2,,3]);return[4,this.fetchListings()];case 1:t=s.sent();this.listings=t.results;this.resultCount=t.total;this.activeCount=t.total_active;this.inactiveCount=t.total_inactive;this.loaded=true;return[3,3];case 2:e=s.sent();u.error(e.message);return[3,3];case 3:return[2]}}))}))};t.prototype.fetchListings=function(){return __awaiter(this,void 0,void 0,(function(){var t,e;return __generator(this,(function(s){switch(s.label){case 0:s.trys.push([0,2,,3]);return[4,d.getListings(this.searchParams)];case 1:t=s.sent();return[2,t];case 2:e=s.sent();return[2,u.error("Could not retrieve listings: "+e.message)];case 3:return[2]}}))}))};t.prototype.search=function(t){if(t){t.preventDefault()}var e=this.el.querySelector("#admin-listing-search");if(e.value!==this.searchParams.search_query){this.searchParams.search_query=e.value}this.searchParams.offset=0;this.renderListings()};t.prototype.toggleBoolean=function(t,e){return __awaiter(this,void 0,void 0,(function(){var s,n,r,i;return __generator(this,(function(a){switch(a.label){case 0:s={id:t.id};s[e]=!t[e];a.label=1;case 1:a.trys.push([1,3,,4]);return[4,g.updateApt(s)];case 2:n=a.sent();r=this.listings.map((function(t){if(t.id===n.id){return n}return t}));this.listings=r;if(e==="is_active"){if(n.is_active){this.activeCount++;this.inactiveCount--}else{this.activeCount--;this.inactiveCount++}}return[3,4];case 3:i=a.sent();u.error(i.message);return[3,4];case 4:return[2]}}))}))};t.prototype.infiniteScroll=function(){return __awaiter(this,void 0,void 0,(function(){var t,e;return __generator(this,(function(s){switch(s.label){case 0:this.searchParams.offset=this.listings.length;s.label=1;case 1:s.trys.push([1,3,,4]);return[4,this.fetchListings()];case 2:t=s.sent();if(t.results){this.listings=__spreadArrays(this.listings,t.results)}return[3,4];case 3:e=s.sent();u.error("Could not retrieve listings: "+e.message);return[3,4];case 4:return[2]}}))}))};t.prototype.goTo=function(t){a.forward(t)};t.prototype.listingsScroll=function(t){var e=t.target.scrollHeight-t.target.clientHeight-t.target.scrollTop;if(e>300){return}this.infiniteScroll()};t.prototype.deleteListing=function(t){return __awaiter(this,void 0,void 0,(function(){var e,s,n;return __generator(this,(function(r){switch(r.label){case 0:r.trys.push([0,3,,4]);return[4,p.confirm("Deleting this is a permanent action, are you sure you want to delete the apartment?","Are you sure?")];case 1:if(!r.sent()){return[2]}return[4,g.deleteApt(t)];case 2:e=r.sent();if(e.success){s=this.listings.filter((function(e){return e.id!==t}));this.listings=s;u.success("Apartment has been deleted")}else{if(e.errors){u.error(e.errors.join("\n"));return[2]}if(e.message){u.error(e.message)}}return[3,4];case 3:n=r.sent();u.error(n.message);return[3,4];case 4:return[2]}}))}))};t.prototype.getTableHeight=function(){if(!this.listingsWrapper){return"500px"}return this.screenHeight-this.listingsWrapper.offsetTop-150+"px"};t.prototype.updateApt=function(t){var e=this.listings.map((function(e){return e.id===t.id?t:e}));this.listings=e;this.formFocus=null};t.prototype.changeSearchType=function(){this.searchParams=Object.assign(Object.assign({},this.searchParams),{search_type:this.searchTypeInput.value})};t.prototype.setActiveFilter=function(t){this.searchParams=Object.assign(Object.assign({},this.searchParams),{active:t});this.search()};t.prototype.setSort=function(t,e){if(e===void 0){e=null}this.searchParams=Object.assign(Object.assign({},this.searchParams),{sortBy:t});if(e!==null){this.searchParams=Object.assign(Object.assign({},this.searchParams),{price_month:e})}this.search()};t.prototype.render=function(){var t=this;return[n("admin-header",null),n("ion-content",{class:"page-admin-listings"},n("h2",{class:"text-center"},"Listings"),n("section",{class:"section full"},this.loaded?n("div",{class:"listings-totals text-right"},"Total Listings: ",this.activeCount+this.inactiveCount," ",n("br",null),"Total Active Listings: ",this.activeCount," ",n("br",null)):null,n("form",{class:"search",onSubmit:function(e){return t.search(e)}},n("label",{htmlFor:"admin-listing-search",class:"sr-only"},"Search"),n("input",{id:"admin-listing-search",type:"text",class:"apt212-input",name:"search_query",placeholder:"search"}),n("select",{name:"search_by",class:"apt212-input",onChange:function(){return t.changeSearchType()},ref:function(e){return t.searchTypeInput=e}},n("option",{value:"webid"},"Web ID"),n("option",{value:"address"},"Address"),n("option",{value:"owner"},"Owner")),n("button",{type:"submit",class:"button-dark search-submit","aria-label":"Search"},n("svg",{class:"feather feather-search",viewBox:"0 0 25 24",version:"1.1"},n("g",{stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"},n("path",{d:"M24,21.1886008 L18.6803754,15.9186997 C19.949079,14.3099652 20.6588954,12.3179013 20.6588954,10.238277 C20.6588954,5.14393658 16.472729,1 11.3303363,1 C6.18621089,1 2,5.14393658 2,10.238277 C2,15.3308573 6.18616646,19.4765539 11.3303363,19.4765539 C13.3071236,19.4765539 15.2318387,18.8457674 16.8196842,17.7010588 L22.1704099,23 L24,21.1886008 Z M11.3302919,16.9140717 C7.61273046,16.9140717 4.58934605,13.9182757 4.58934605,10.238365 C4.58934605,6.55849823 7.61268603,3.56265825 11.3302919,3.56265825 C15.0461205,3.56265825 18.0694605,6.55845423 18.0694605,10.238365 C18.0694605,12.2063608 17.1982293,14.0643123 15.6796059,15.3379854 C14.4664401,16.3537734 12.9218251,16.9140717 11.3302919,16.9140717 Z",fill:"#ffffff"})))),n("div",{class:"flex-spacer"}),n("button",{type:"button",class:{"button-dark":true,"active-filter":true,inactive:this.searchParams.active!=="all"},onClick:function(){return t.setActiveFilter("all")}},"All"),n("button",{type:"button",class:{"button-dark":true,"active-filter":true,inactive:this.searchParams.active!=="active"},onClick:function(){return t.setActiveFilter("active")}},"Active"),n("button",{type:"button",class:{"button-dark":true,"active-filter":true,inactive:this.searchParams.active!=="inactive"},onClick:function(){return t.setActiveFilter("inactive")}},"Inactive"),n("button",{type:"button",class:"button-dark add-new","aria-label":"Add New",onClick:function(){return t.goTo("/admin/listing/add")}},n("ion-icon",{name:"add-circle"}))),this.loaded?n("div",{class:"listings",onScroll:function(e){return t.listingsScroll(e)},style:{maxHeight:this.getTableHeight()},ref:function(e){return t.listingsWrapper=e}},n("table",{class:"data-table"},n("thead",null,n("tr",null,n("th",null,n("button",{class:{"button-reset":true,desc:this.searchParams.sortBy==="webid_desc"},onClick:function(){return t.setSort(t.searchParams.sortBy==="webid_desc"?"webid_asc":"webid_desc")}},"Web Id ",n("ion-icon",{src:"/assets/images/icons/page_sort_arrow.svg"}))),n("th",{class:"mobile-only"},"Info"),n("th",{class:"desktop-only"},n("button",{class:{"button-reset":true,desc:this.searchParams.sortBy==="last_updated_desc"},onClick:function(){return t.setSort(t.searchParams.sortBy==="last_updated_desc"?"last_updated_asc":"last_updated_desc")}},"Last Updated",n("ion-icon",{src:"/assets/images/icons/page_sort_arrow.svg"}))),n("th",{class:"desktop-only"},"Status"),n("th",{class:"desktop-only"},n("button",{class:{"button-reset":true,desc:this.searchParams.sortBy==="owner_desc"},onClick:function(){return t.setSort(t.searchParams.sortBy==="owner_desc"?"owner_asc":"owner_desc")}},"Owner",n("ion-icon",{src:"/assets/images/icons/page_sort_arrow.svg"}))),n("th",{class:"desktop-only"},"Address"),n("th",{class:"desktop-only"},"APT#"),n("th",{class:"desktop-only"},n("button",{class:{"button-reset":true,desc:this.searchParams.sortBy==="bedrooms_desc"},onClick:function(){return t.setSort(t.searchParams.sortBy==="bedrooms_desc"?"bedrooms_asc":"bedrooms_desc")}},"BR",n("ion-icon",{src:"/assets/images/icons/page_sort_arrow.svg"}))),n("th",{class:"desktop-only"},n("button",{class:{"button-reset":true,desc:this.searchParams.sortBy==="bathrooms_desc"},onClick:function(){return t.setSort(t.searchParams.sortBy==="bathrooms_desc"?"bathrooms_asc":"bathrooms_desc")}},"Bath",n("ion-icon",{src:"/assets/images/icons/page_sort_arrow.svg"}))),n("th",{class:"desktop-only"},n("button",{class:{"button-reset":true,desc:this.searchParams.sortBy==="availability_desc"},onClick:function(){return t.setSort(t.searchParams.sortBy==="availability_desc"?"availability_asc":"availability_desc")}},"Availability",n("ion-icon",{src:"/assets/images/icons/page_sort_arrow.svg"}))),n("th",{class:"desktop-only"},n("button",{class:{"button-reset":true,desc:this.searchParams.sortBy==="price_desc"},onClick:function(){return t.setSort(t.searchParams.sortBy==="price_desc"?"price_asc":"price_desc")}},"Price",n("ion-icon",{src:"/assets/images/icons/page_sort_arrow.svg"}))),__spreadArrays(Array(12).keys()).map((function(e){var s=new Date((new Date).setDate(1)).setMonth(e);return n("th",{class:"desktop-only"},n("button",{class:{"button-reset":true,desc:t.searchParams.sortBy==="price_month_desc"&&t.searchParams.price_month===e},onClick:function(){return t.setSort(t.searchParams.sortBy==="price_month_desc"?"price_month_asc":"price_month_desc",e)}},l(s,"MMM"),n("ion-icon",{src:"/assets/images/icons/page_sort_arrow.svg"})))})),n("th",{class:"desktop-only"},"Featured 1"),n("th",{class:"desktop-only"},"Featured 2"),n("th",{class:"desktop-only"},"Featured 3"),n("th",null,"Action"))),n("tbody",null,this.listings.map((function(e){var s=h.getBedroomTypeById(e.bedroom_type_id,t.bedroomTypes);return n("tr",null,n("td",null,e.id),n("td",{class:"mobile-only"},n("div",null,e.apartment_number?e.apartment_number+" ":"",e.address),s?n("div",null,"BD: ",s.name):"",n("div",null,"BA: ",e.bathrooms),n("div",null,c(e.rate)),n("div",null,l(e.available_date))),n("td",{class:"desktop-only"},l(e.updated_at)),n("td",{class:"desktop-only"},n("button",{class:{"button-dark":true,inactive:!e.is_active},onClick:function(){return t.toggleBoolean(e,"is_active")}},e.is_active?"Active":"Inactive")),n("td",null,e.owner_name),n("td",{class:"desktop-only"},e.address),n("td",{class:"desktop-only"},e.apartment_number),n("td",{class:"desktop-only"},s?s.name:""),n("td",{class:"desktop-only"},e.bathrooms),n("td",{class:"desktop-only"},t.formFocus==="available_date-"+e.id?n("listing-availability-form",{item:e,onUpdateSuccess:function(e){return t.updateApt(e.detail)}}):n("button",{class:"button-reset",onClick:function(){return t.formFocus="available_date-"+e.id}},l(e.available_date))),n("td",{class:"desktop-only"},c(e.rate)),__spreadArrays(new Array(12).keys()).map((function(s){return n("td",{class:"desktop-only"},t.formFocus==="monthly_rate-"+e.id+"-"+s?n("listing-monthly-rate-form",{item:e,month:s,onUpdateSuccess:function(e){return t.updateApt(e.detail)}}):n("button",{class:"button-reset",onClick:function(){return t.formFocus="monthly_rate-"+e.id+"-"+s}},c(e.rates.find((function(t){return t.month==s})).monthly_rate)))})),n("td",{class:"desktop-only"},n("button",{class:{"button-dark":true,inactive:!e.feature_1},onClick:function(){return t.toggleBoolean(e,"feature_1")}},e.feature_1?"On":"Off")),n("td",{class:"desktop-only"},n("button",{class:{"button-dark":true,inactive:!e.feature_2},onClick:function(){return t.toggleBoolean(e,"feature_2")}},e.feature_2?"On":"Off")),n("td",{class:"desktop-only"},n("button",{class:{"button-dark":true,inactive:!e.feature_3},onClick:function(){return t.toggleBoolean(e,"feature_3")}},e.feature_3?"On":"Off")),n("td",{class:"no-wrap"},n("button",{class:"button-dark",onClick:function(){return t.deleteListing(e.id)}},n("ion-icon",{name:"trash"})),n("button",{class:"button-dark",onClick:function(){return t.goTo("/admin/listing/edit/"+e.id)}},n("ion-icon",{name:"settings"})),n("div",{class:"toggle-active"},n("button",{class:"button-dark",onClick:function(){return t.toggleBoolean(e,"is_active")}},e.is_active?"Active":"Inactive"))))}))))):n("div",{class:"text-center"},n("ion-spinner",{name:"lines"}))))]};Object.defineProperty(t.prototype,"el",{get:function(){return r(this)},enumerable:true,configurable:true});Object.defineProperty(t,"style",{get:function(){return".page-admin-listings .listings{margin-top:32px;padding-bottom:32px;max-height:500px;overflow:auto}.page-admin-listings .listings .data-table thead th{position:-webkit-sticky;position:sticky;top:0;background-color:#fff;white-space:nowrap;padding-right:8px}.page-admin-listings .listings .data-table thead th button{font-weight:inherit}.page-admin-listings .listings .data-table thead th button.desc ion-icon{-webkit-transform:rotate(180deg);transform:rotate(180deg)}.page-admin-listings .listings .data-table thead th ion-icon{font-size:12px;margin-left:4px}.page-admin-listings .listings .data-table td{white-space:nowrap;background-color:#fff}.page-admin-listings button.button-dark.inactive{background-color:#888}.page-admin-listings button.button-dark.active-filter{margin-right:8px}.page-admin-listings .listings-totals{margin-top:-40px;padding-bottom:8px}.page-admin-listings .search{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center}.page-admin-listings .search .search-submit svg{width:1rem;height:1rem}.page-admin-listings .search button{height:48px}.page-admin-listings .add-new{margin-left:4px;font-size:18px}.page-admin-listings .toggle-active{padding-top:4px}\@media (min-width:1200px){.page-admin-listings .toggle-active{display:none}}"},enumerable:true,configurable:true});return t}());m([o(100)],y.prototype,"listingsScroll",null)}}}));