import{r as t,h as i,d as e,j as s,c as l}from"./p-f5b6b644.js";import"./p-19ec51eb.js";import{A as a}from"./p-811a61b7.js";import"./p-74149bb1.js";import{a as n}from"./p-08706a58.js";import{s as o}from"./p-c041151f.js";import{T as h}from"./p-2c007f74.js";import{t as d}from"./p-7295e390.js";import{A as c}from"./p-ecdfa480.js";import{A as u}from"./p-d2e35ecb.js";import{n as r}from"./p-8f87c93e.js";const p=class{constructor(i){t(this,i),this.value="",this.format="m/d/y",this.placeholder=""}async init(){const t=document.createElement("ion-modal");t.component="input-date-modal",t.componentProps={value:this.value,label:this.label,helpText:this.helpText},document.body.append(t),t.present();const i=await t.onWillDismiss();i&&i.data&&i.data.value&&(this.value=n(i.data.value,this.format))}getValue(){return this.value?n(this.value,this.format):""}render(){return i("div",{class:"input-date-component"},i("input",{type:"text",name:this.name,class:"apt212-input block",autocomplete:"off",value:this.getValue(),onClick:()=>this.init(),placeholder:this.placeholder}))}static get style(){return".input-date-component{display:block}"}},m=new class{async imageUpload(t){try{const i=a.getHeaders();delete i["Content-Type"];let e=await fetch(a.getAPIUrl()+"/image-upload",{headers:i,method:"POST",body:t});if(!e.ok){let t=e.statusText;const i=await e.json();throw i&&i.message&&(t=i.message),i&&i.errors&&i.errors.file&&i.errors.file.length&&(t=i.errors.file[0]),new Error(t)}return await e.json()}catch(t){throw new Error(t.message)}}async imageDelete(t){try{const i=a.getHeaders();let e=await fetch(a.getAPIUrl()+"/image-upload/"+t,{headers:i,method:"DELETE"});if(!e.ok){let t=e.statusText;const i=await e.json();throw i&&i.message&&(t=i.message),i&&i.errors&&i.errors.file&&i.errors.file.length&&(t=i.errors.file[0]),new Error(t)}return await e.json()}catch(t){throw new Error(t.message)}}},b=class{constructor(i){t(this,i),this.limit=0,this.value=[],this.accept="image/*",this.hasTitle=!1,this.hasDescription=!1,this.uploadInProgress=!1,this.internalValue=[]}componentWillLoad(){this.internalValue=this.value}async uploadHandler(){const t=this.fileInput.files,i=this.el.querySelector(".description"),e=this.el.querySelector(".title");if(t.length&&t[0]&&t[0].size){this.uploadInProgress=!0;const s=new FormData;s.append("file",t[0]),s.append("name",this.name),e&&s.append("title",e.value),i&&s.append("description",i.value);try{const t=await m.imageUpload(s);this.internalValue=[...this.internalValue,t],this.fileInput.value="",e&&(e.value=""),i&&(i.value="")}catch(t){h.error(t.message)}}this.uploadInProgress=!1}async delete(t){if(await c.confirm("Are you sure?","Delete Image"))try{if((await m.imageDelete(t)).success){const i=this.internalValue.filter(i=>i.id!==t);this.internalValue=i}}catch(t){h.error(t.message)}}render(){return i("div",{class:"input-image-component"},!this.limit||this.internalValue.length<this.limit?i("div",{class:""},i("input",{type:"file",accept:this.accept,ref:t=>this.fileInput=t}),i("div",{class:"metadata"},this.hasTitle?i("div",{class:"input"},i("label",{htmlFor:`image-title-${this.name}`},"Title"),i("input",{id:`image-title-${this.name}`,type:"text",class:"apt212-input block title"})):null,this.hasDescription?i("div",{class:"input"},i("label",{htmlFor:`image-description-${this.name}`},"Description"),i("textarea",{id:`image-description-${this.name}`,class:"apt212-input description"})):null,i("div",{class:"flex-vertical-center"},i("button",{type:"button",class:"button-dark",onClick:()=>this.uploadHandler()},"Upload"),this.uploadInProgress?i("ion-spinner",{name:"lines"}):null))):i("div",null,"The maximum number of images has been reached.  Delete existing images to add new ones."),i("div",{class:"value"},this.internalValue.map((t,e)=>i("div",{class:"image-value flex-vertical-center"},i("div",{class:"image-preview"},i("h4",{style:{margin:"0"}},"(",e+1,")"),i("img",{src:t.small,class:"preview"})),i("div",{class:"metadata"},this.hasTitle?i("div",{class:"input"},i("label",{htmlFor:`image-title-${t.id}`},"Title"),i("input",{type:"text",class:"apt212-input block title",value:t.title,name:`${this.name}_titles[]`}),i("input",{type:"hidden",name:`${this.name}_titles_ids[]`,value:t.id})):null,this.hasDescription?i("div",{class:"input"},i("label",{htmlFor:`image-description-${t.id}`},"Description"),i("textarea",{class:"apt212-input block description",name:`${this.name}_descriptions[]`},t.description)):null,i("input",{type:"hidden",name:`${this.name}[]`,value:t.id})),i("div",{class:"action"},i("button",{type:"button",class:"button-dark block",onClick:()=>this.delete(t.id)},"Delete"))))))}get el(){return e(this)}static get style(){return".input-image-component .value .preview{max-width:150px}.input-image-component .value .metadata{-ms-flex-positive:1;flex-grow:1;padding:16px}.input-image-component .image-value{padding-top:8px}.input-image-component .action button:not(:last-child){margin-bottom:8px}"}},v=new class{async geocodeAddress(t){try{let i=await fetch(a.getAPIUrl()+"/neighborhoods/geocode/"+encodeURIComponent(t),{headers:a.getHeaders()});if(!i.ok){const t=i.statusText,e=await i.json();if(e.hasOwnProperty("message"))throw new Error(e.message);throw new Error(t)}return await i.json()}catch(t){throw new Error(t.message)}}async neighborhoodsFromPoint(t,i){try{let e=await fetch(a.getAPIUrl()+`/neighborhoods/fromPoint/${t}/${i}`,{headers:a.getHeaders()});if(!e.ok){const t=e.statusText,i=await e.json();if(i.hasOwnProperty("message"))throw new Error(i.message);throw new Error(t)}return await e.json()}catch(t){throw new Error(t.message)}}},g=class{constructor(i){t(this,i),this.geocodingInProgress=!1,this.blockedDateErrors=[],this.blockedDates=[],this.isLoggedIn=!1,this.isAdmin=!1,this.submitting=!1,this.success=s(this,"success",7),this.store=l(this,"store")}componentWillLoad(){this.store.mapStateToProps(this,t=>({bedroomTypes:d.getBedroomTypes(t),buildingTypes:d.getBuildingTypes(t),neighborhoods:d.getNeighborhoods(t),subways:d.getSubways(t),amenities:d.getAmenities(t)})),this.blockedDates=this.item&&this.item.block_dates?this.item.block_dates:[]}componentDidLoad(){this.el.querySelectorAll("input.rate-input.monthly_rate").forEach(t=>{const i=document.createEvent("HTMLEvents");i.initEvent("change",!1,!0),t.dispatchEvent(i)})}async onSubmit(t){t.preventDefault(),this.submitting=!0;const i=o(this.form,{hash:!0,empty:!0});try{const t=await u.updateApt(i);this.submitting=!1,h.success("Apartment has been saved"),this.success.emit(t)}catch(t){h.error(t.message),this.submitting=!1}}async geocodeListing(){const t=o(this.form,{hash:!0,empty:!0});if(!t.address||!t.city||!t.state)return void h.error("Please enter an address, city, and state to find the latitude/longitude");this.geocodingInProgress=!0;let i=t.address;t.city&&(i=i?`${i} ${t.city}`:t.city),t.state&&(i=i?`${i} ${t.state}`:t.state),t.zip&&(i=i?`${i} ${t.zip}`:t.zip);try{const t=await v.geocodeAddress(i);this.longitudeInput.value=t.lng,this.latitudeInput.value=t.lat;const e=t.neighborhoods.reduce((t,i)=>(t.length&&(t=`${t}, `),t+i.name),"");this.neighborhoodsInput.value=e}catch(t){h.error(t.message)}this.geocodingInProgress=!1}async updateNeighborhoods(){if(this.longitudeInput.value.length&&this.latitudeInput.value.length)try{const t=(await v.neighborhoodsFromPoint(this.longitudeInput.value,this.latitudeInput.value)).reduce((t,i)=>(t.length&&(t=`${t}, `),t+i.name),"");this.neighborhoodsInput.value=t}catch(t){h.error(t.message)}}selectSubway(t,i){if(t.currentTarget.classList.toggle("selected"),t.currentTarget.classList.contains("selected")){const t=document.createElement("input");t.setAttribute("type","hidden"),t.setAttribute("name","subways[]"),t.value=i.id,this.subwayInputs.appendChild(t)}else{const t=this.subwayInputs.querySelector('input[value="'+i.id+'"]');t&&t.remove()}}selectAmenity(t,i){if(t.currentTarget.classList.toggle("selected"),t.currentTarget.classList.contains("selected")){const t=document.createElement("input");t.setAttribute("type","hidden"),t.setAttribute("name","amenities[]"),t.value=i.id,this.amenityInputs.appendChild(t)}else{const t=this.amenityInputs.querySelector('input[value="'+i.id+'"]');t&&t.remove()}}addBlockedDate(){const t=this.blockDateStartInput.getAttribute("value"),i=this.blockDateEndInput.getAttribute("value");t&&i?new Date(i)<=new Date(t)?this.blockedDateErrors=["End date must be after the start date"]:(this.blockedDates=[...this.blockedDates,{start:t,end:i}],this.blockedDateErrors=[],this.blockDateStartInput.setAttribute("value",""),this.blockDateEndInput.setAttribute("value","")):this.blockedDateErrors=["Please select a start/end date"]}removeBlockedDate(t){const i=[...this.blockedDates];i.splice(t,1),this.blockedDates=i}render(){let t="";return this.item&&(t=this.item.neighborhood_ids.reduce((t,i)=>{let e=t.split(", ").filter(t=>!!t);const s=r.getNeighborhoodById(i,this.neighborhoods);return s&&e.push(s.name),e.join(", ")},t)),[i("div",{class:"listing-edit-form-component"},i("form",{onSubmit:t=>this.onSubmit(t),ref:t=>this.form=t},i("fieldset",null,i("h3",null,"1. Address"),i("div",{class:"fieldset-inputs address"},i("div",{class:"input"},i("label",{htmlFor:"listing-webid"},"Web ID"),i("input",{type:"text",id:"listing-webid",class:"apt212-input block",value:this.item?this.item.id:"",disabled:!0}),i("input",{type:"hidden",name:"id",value:this.item?this.item.id:""})),i("div",{class:"input"},i("label",{htmlFor:"owner-name"},"Owner Name"),i("input",{id:"owner-name",name:"owner_name",class:"apt212-input block",value:this.item?this.item.owner_name:""})),i("div",{class:"input"},i("label",{htmlFor:"address"},"Address"),i("input",{id:"address",name:"address",class:"apt212-input block",value:this.item?this.item.address:""})),i("div",{class:"input"},i("label",{htmlFor:"apt-num"},"Apt#"),i("input",{id:"apt-num",name:"apartment_number",class:"apt212-input block",value:this.item?this.item.apartment_number:""})),i("div",{class:"input"},i("label",{htmlFor:"city"},"City"),i("input",{id:"city",name:"city",class:"apt212-input block",value:this.item?this.item.city:""})),i("div",{class:"input"},i("label",{htmlFor:"state"},"State"),i("input",{id:"state",name:"state",class:"apt212-input block",value:this.item?this.item.state:""})),i("div",{class:"input"},i("label",{htmlFor:"zipcode"},"Zip"),i("input",{id:"zipcode",name:"zip",class:"apt212-input block",value:this.item?this.item.zip:""})),i("div",{class:"input"},i("label",{htmlFor:"cross-streets"},"Cross Streets"),i("input",{id:"cross-streets",name:"cross_streets",class:"apt212-input block",value:this.item?this.item.cross_streets:""}))),i("div",{class:"flex-vertical-center action-button"},i("button",{type:"button",class:"button-dark",onClick:()=>this.geocodeListing()},"Find Latitude/Longitude"),this.geocodingInProgress?i("ion-spinner",{name:"lines"}):null),i("div",{class:"fieldset-inputs address"},i("div",{class:"input"},i("label",{htmlFor:"neighborhoods"},"Neighborhoods"),i("input",{id:"neighborhoods",name:"neighborhoods",value:t,class:"apt212-input block",disabled:!0,ref:t=>this.neighborhoodsInput=t})),i("div",{class:"input"},i("label",{htmlFor:"latitude"},"Latitude"),i("input",{id:"latitude",name:"lat",value:this.item?this.item.lat:"",class:"apt212-input block",ref:t=>this.latitudeInput=t,onChange:()=>this.updateNeighborhoods()})),i("div",{class:"input"},i("label",{htmlFor:"longitude"},"Longitude"),i("input",{id:"longitude",name:"lng",value:this.item?this.item.lng:"",class:"apt212-input block",ref:t=>this.longitudeInput=t,onChange:()=>this.updateNeighborhoods()})))),i("fieldset",null,i("h3",null,"2. Description"),i("div",{class:"fieldset-inputs description"},i("div",{class:"input"},i("label",{htmlFor:"listing-title"},"Title"),i("input",{id:"listing-title",name:"title",class:"apt212-input block",value:this.item?this.item.title:""})),i("div",{class:"input"},i("label",{htmlFor:"listing-description"},"Description"),i("textarea",{id:"listing-description",name:"description",class:"apt212-input block"},this.item?this.item.description:"")))),i("fieldset",null,i("h3",null,"3. Features"),i("div",{class:"fieldset-inputs features"},i("div",{class:"input"},i("label",{htmlFor:"listing-bedrooms"},"Bedrooms"),i("select",{id:"listing-bedrooms",class:"apt212-input block",name:"bedroom_type_id"},this.bedroomTypes.map(t=>i("option",{value:t.id,selected:!!this.item&&this.item.bedroom_type_id===t.id},t.name)))),i("div",{class:"input"},i("label",{htmlFor:"listing-bathrooms"},"Bathrooms"),i("select",{id:"listing-bathrooms",class:"apt212-input block",name:"bathrooms"},[1,1.5,2,2.5,3,3.5,4].map(t=>i("option",{value:t,selected:!!this.item&&this.item.bathrooms===t},t)))),i("div",{class:"input"},i("label",{htmlFor:"listing-buildingtype"},"Building Type"),i("select",{id:"listing-buildingtype",class:"apt212-input block",name:"building_type_id"},this.buildingTypes.map(t=>i("option",{value:t.id,selected:!!this.item&&this.item.building_type_id===t.id},t.name)))),i("div",{class:"input"},i("label",{htmlFor:"listing-floor"},"Floor"),i("input",{id:"listing-floor",class:"apt212-input block",name:"floor",value:this.item?this.item.floor:""})),i("div",{class:"input"},i("label",{htmlFor:"listing-size"},"Square Footage"),i("input",{id:"listing-size",class:"apt212-input block",name:"size",value:this.item?this.item.size:""})))),i("fieldset",null,i("h3",null,"4. Subways"),i("div",{class:"fieldset-inputs subways"},this.subways.map(t=>i("button",{type:"button",class:{"button-reset":!0,subway:!0,selected:this.item&&!!this.item.subways.filter(i=>i.id===t.id).length},"aria-label":`Subway station ${t.name}`,onClick:i=>this.selectSubway(i,t)},i("img",{src:t.icon,alt:t.name})))),i("div",{class:"subways-inputs",ref:t=>this.subwayInputs=t},this.item&&this.item.subways.map(t=>i("input",{type:"hidden",name:"subways[]",value:t.id})))),i("fieldset",null,i("h3",null,"5. Amenities"),i("div",{class:"fieldset-inputs amenities"},this.amenities.map(t=>i("button",{type:"button",class:{"button-reset":!0,amenity:!0,selected:this.item&&!!this.item.amenities.filter(i=>i.id===t.id).length},"aria-label":`${t.name}`,onClick:i=>this.selectAmenity(i,t)},i("img",{src:t.icon,alt:t.name})," ",t.name))),i("div",{class:"amenities-inputs",ref:t=>this.amenityInputs=t},this.item&&this.item.amenities.map(t=>i("input",{type:"hidden",name:"amenities[]",value:t.id})))),i("fieldset",null,i("h3",null,"6. Availability"),i("div",{class:"fieldset-inputs availability"},i("div",{class:"input"},i("label",{htmlFor:"next-available-date"},"Next Available Date"),i("input-date",{name:"available_date",label:"Next Available Date","help-text":"Select the next day the listing is available",value:this.item?this.item.available_date:""})),i("div",{class:"block-dates"},i("div",null,i("strong",null,"Blocked Dates"),i("div",{class:"help-text"},"Dates listed here will be unable to be booked")),this.blockedDates.length?this.blockedDates.map((t,e)=>i("div",{class:"block-date"},n(t.start,"m/d/y")," - ",n(t.end,"m/d/y"),i("button",{type:"button",class:"button-reset",onClick:()=>this.removeBlockedDate(e)},i("ion-icon",{name:"close"})),i("input",{type:"hidden",name:"block_dates[start][]",value:t.start}),i("input",{type:"hidden",name:"block_dates[end][]",value:t.end}))):i("div",{class:"placeholder"},"No dates are currently blocked"),i("input",{type:"hidden",name:"block_dates_update",value:1})),i("div",{class:"block-date-input hidden"},i("div",{class:"input start"},i("label",{htmlFor:"block-date-input-start-placeholder"},"Start"),i("input-date",{id:"block-date-input-start-placeholder",value:"",label:"Start of blocked dates",ref:t=>this.blockDateStartInput=t})),i("div",{class:"input end"},i("label",{htmlFor:"block-date-input-end-placeholder"},"End"),i("input-date",{id:"block-date-input-end-placeholder",value:"",label:"End of blocked dates",ref:t=>this.blockDateEndInput=t})),i("div",null,this.blockedDateErrors.length?i("div",{class:"errors"},this.blockedDateErrors.map(t=>i("div",null,t))):null,i("button",{type:"button",class:"button-dark",onClick:()=>this.addBlockedDate()},"Add to blocked dates"))))),i("fieldset",null,i("h3",null,"7. Pricing"),i("input-pricing",{name:"rates",rate:this.item?this.item.rates.find(t=>"default"===t.month):null,onRateChanged:t=>this.monthRatesInput.updateDefault(t.detail.key,t.detail.value)})),i("fieldset",null,i("h3",null,"8. Month Specific Rates"),i("input-month-rates",{name:"rates",rates:this.item?this.item.rates:[],ref:t=>this.monthRatesInput=t})),i("fieldset",null,i("h3",null,"9. Utilities/Move out fee"),i("input-utilities",{item:this.item?this.item:null})),i("fieldset",null,i("h3",null,"10. Payment Time Line"),i("input-payment-timeline",{item:this.item?this.item:null})),i("fieldset",null,i("h3",null,"11. Images"),i("input-image",{name:"images",value:this.item?this.item.images:[],"has-description":!0})),i("fieldset",null,i("h3",null,"12. Floorplan"),i("input-image",{name:"floor_plans",limit:3,value:this.item?this.item.floor_plans:[]})),i("fieldset",null,i("h3",null,"13. Video"),i("div",{class:"fieldset-inputs video"},i("div",{class:"input"},i("label",{htmlFor:"listing-video",class:"sr-only"},"Video"),i("input",{id:"listing-video",name:"video_url",class:"apt212-input block",placeholder:"https://www.youtube.com/watch?v=xxxxxxxxxxxx",value:this.item?this.item.video_url:""}),i("div",{class:"help-text"},"Enter a Youtube video URL")))),i("input",{type:"submit",class:"button-dark",value:"Save",disabled:this.submitting})))]}get el(){return e(this)}static get style(){return".listing-edit-form-component .action-button{margin-bottom:16px}.listing-edit-form-component .fieldset-inputs label{display:block;font-weight:700}.listing-edit-form-component .fieldset-inputs.address{display:grid;gap:8px;-ms-flex-align:center;align-items:center;grid-template-columns:repeat(auto-fit,minmax(300px,1fr))}.listing-edit-form-component .fieldset-inputs.features{display:grid;gap:8px;-ms-flex-align:center;align-items:center;grid-template-columns:repeat(auto-fit,minmax(200px,1fr))}.listing-edit-form-component .fieldset-inputs.subways{display:grid;gap:8px;-ms-flex-align:center;align-items:center;grid-template-columns:repeat(auto-fit,minmax(300px,1fr))}.listing-edit-form-component .fieldset-inputs.subways button{border:1px solid #000;padding-top:4px;padding-bottom:4px}.listing-edit-form-component .fieldset-inputs.subways button.selected{background-color:#057365}.listing-edit-form-component .fieldset-inputs.subways button img{background-color:#fff;border-radius:50%}.listing-edit-form-component .fieldset-inputs.amenities{display:grid;gap:8px;-ms-flex-align:center;align-items:center;grid-template-columns:repeat(auto-fit,minmax(200px,1fr))}.listing-edit-form-component .fieldset-inputs.amenities button{border:1px solid #000;padding-top:4px;padding-bottom:4px}.listing-edit-form-component .fieldset-inputs.amenities button.selected{background-color:#057365;color:#fff}.listing-edit-form-component .fieldset-inputs.amenities button img{width:30px;height:30px;padding:3px;background-color:#fff;border-radius:6px;vertical-align:middle;-o-object-fit:contain;object-fit:contain}.listing-edit-form-component .monthly-rates-wrapper{width:100%;overflow-x:auto}.listing-edit-form-component .monthly-rates .monthly-rate{min-width:75px}.listing-edit-form-component .monthly-rates thead td{text-align:center;font-weight:700}.listing-edit-form-component .monthly-rates td{vertical-align:middle;padding-bottom:4px}.listing-edit-form-component .monthly-rates td input.apt212-input{margin:0}.listing-edit-form-component .monthly-rates .label{white-space:nowrap;padding-right:4px;font-weight:700}.listing-edit-form-component .block-date{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;padding-top:16px}.listing-edit-form-component .block-date button{padding-top:3px;margin-left:16px;font-size:18px}.listing-edit-form-component .block-date-input{padding-top:16px}.listing-edit-form-component .block-date-input .input{display:inline-block;padding-right:16px}.listing-edit-form-component .errors{padding-top:8px;padding-bottom:8px;color:red}"}};export{p as input_date,b as input_image,g as listing_edit_form};