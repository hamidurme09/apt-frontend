import{r as t,c as s,h as i,d as e}from"./p-f5b6b644.js";import"./p-19ec51eb.js";import"./p-811a61b7.js";import"./p-74149bb1.js";import{a}from"./p-5444f5ad.js";import{R as o}from"./p-9d127c97.js";import{D as n}from"./p-82599b58.js";import{f as c,a as l}from"./p-08706a58.js";import{T as r}from"./p-2c007f74.js";import{A as h}from"./p-5908b5da.js";import{t as d}from"./p-7295e390.js";import{s as u}from"./p-4c12f224.js";import{A as p}from"./p-ecdfa480.js";import{A as b}from"./p-d2e35ecb.js";const m=class{constructor(i){t(this,i),this.isAdmin=!1,this.isLoggedIn=!1,this.pageSize=40,this.loaded=!1,this.listings=[],this.searchParams={sortBy:"webid_asc",price_month:0,active:"all",search_type:"webid",search_query:"",offset:0,limit:this.pageSize},this.resultCount=0,this.activeCount=0,this.inactiveCount=0,this.formFocus=null,this.store=s(this,"store")}componentWillLoad(){this.store.mapStateToProps(this,t=>({isLoggedIn:a.isLoggedIn(t),isAdmin:a.isAdmin(t),bedroomTypes:d.getBedroomTypes(t),buildingTypes:d.getBuildingTypes(t),screenHeight:u.getHeight(t)})),this.isLoggedIn?this.isAdmin||o.forward("/"):o.forward("/login")}componentDidLoad(){this.renderListings()}componentDidRender(){requestAnimationFrame(()=>{this.listingsWrapper&&(this.listingsWrapper.style.maxHeight=this.getTableHeight())})}async renderListings(){try{const t=await this.fetchListings();this.listings=t.results,this.resultCount=t.total,this.activeCount=t.total_active,this.inactiveCount=t.total_inactive,this.loaded=!0}catch(t){r.error(t.message)}}async fetchListings(){try{return await h.getListings(this.searchParams)}catch(t){return r.error(`Could not retrieve listings: ${t.message}`)}}search(t){t&&t.preventDefault();const s=this.el.querySelector("#admin-listing-search");s.value!==this.searchParams.search_query&&(this.searchParams.search_query=s.value),this.searchParams.offset=0,this.renderListings()}async toggleBoolean(t,s){const i={id:t.id};i[s]=!t[s];try{const t=await b.updateApt(i),e=this.listings.map(s=>s.id===t.id?t:s);this.listings=e,"is_active"===s&&(t.is_active?(this.activeCount++,this.inactiveCount--):(this.activeCount--,this.inactiveCount++))}catch(t){r.error(t.message)}}async infiniteScroll(){this.searchParams.offset=this.listings.length;try{const t=await this.fetchListings();t.results&&(this.listings=[...this.listings,...t.results])}catch(t){r.error(`Could not retrieve listings: ${t.message}`)}}goTo(t){o.forward(t)}listingsScroll(t){t.target.scrollHeight-t.target.clientHeight-t.target.scrollTop>300||this.infiniteScroll()}async deleteListing(t){try{if(!await p.confirm("Deleting this is a permanent action, are you sure you want to delete the apartment?","Are you sure?"))return;const s=await b.deleteApt(t);if(s.success){const s=this.listings.filter(s=>s.id!==t);this.listings=s,r.success("Apartment has been deleted")}else{if(s.errors)return void r.error(s.errors.join("\n"));s.message&&r.error(s.message)}}catch(t){r.error(t.message)}}getTableHeight(){return this.listingsWrapper?`${this.screenHeight-this.listingsWrapper.offsetTop-150}px`:"500px"}updateApt(t){const s=this.listings.map(s=>s.id===t.id?t:s);this.listings=s,this.formFocus=null}changeSearchType(){this.searchParams=Object.assign(Object.assign({},this.searchParams),{search_type:this.searchTypeInput.value})}setActiveFilter(t){this.searchParams=Object.assign(Object.assign({},this.searchParams),{active:t}),this.search()}setSort(t,s=null){this.searchParams=Object.assign(Object.assign({},this.searchParams),{sortBy:t}),null!==s&&(this.searchParams=Object.assign(Object.assign({},this.searchParams),{price_month:s})),this.search()}render(){return[i("admin-header",null),i("ion-content",{class:"page-admin-listings"},i("h2",{class:"text-center"},"Listings"),i("section",{class:"section full"},this.loaded?i("div",{class:"listings-totals text-right"},"Total Listings: ",this.activeCount+this.inactiveCount," ",i("br",null),"Total Active Listings: ",this.activeCount," ",i("br",null)):null,i("form",{class:"search",onSubmit:t=>this.search(t)},i("label",{htmlFor:"admin-listing-search",class:"sr-only"},"Search"),i("input",{id:"admin-listing-search",type:"text",class:"apt212-input",name:"search_query",placeholder:"search"}),i("select",{name:"search_by",class:"apt212-input",onChange:()=>this.changeSearchType(),ref:t=>this.searchTypeInput=t},i("option",{value:"webid"},"Web ID"),i("option",{value:"address"},"Address"),i("option",{value:"owner"},"Owner")),i("button",{type:"submit",class:"button-dark search-submit","aria-label":"Search"},i("svg",{class:"feather feather-search",viewBox:"0 0 25 24",version:"1.1"},i("g",{stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"},i("path",{d:"M24,21.1886008 L18.6803754,15.9186997 C19.949079,14.3099652 20.6588954,12.3179013 20.6588954,10.238277 C20.6588954,5.14393658 16.472729,1 11.3303363,1 C6.18621089,1 2,5.14393658 2,10.238277 C2,15.3308573 6.18616646,19.4765539 11.3303363,19.4765539 C13.3071236,19.4765539 15.2318387,18.8457674 16.8196842,17.7010588 L22.1704099,23 L24,21.1886008 Z M11.3302919,16.9140717 C7.61273046,16.9140717 4.58934605,13.9182757 4.58934605,10.238365 C4.58934605,6.55849823 7.61268603,3.56265825 11.3302919,3.56265825 C15.0461205,3.56265825 18.0694605,6.55845423 18.0694605,10.238365 C18.0694605,12.2063608 17.1982293,14.0643123 15.6796059,15.3379854 C14.4664401,16.3537734 12.9218251,16.9140717 11.3302919,16.9140717 Z",fill:"#ffffff"})))),i("div",{class:"flex-spacer"}),i("button",{type:"button",class:{"button-dark":!0,"active-filter":!0,inactive:"all"!==this.searchParams.active},onClick:()=>this.setActiveFilter("all")},"All"),i("button",{type:"button",class:{"button-dark":!0,"active-filter":!0,inactive:"active"!==this.searchParams.active},onClick:()=>this.setActiveFilter("active")},"Active"),i("button",{type:"button",class:{"button-dark":!0,"active-filter":!0,inactive:"inactive"!==this.searchParams.active},onClick:()=>this.setActiveFilter("inactive")},"Inactive"),i("button",{type:"button",class:"button-dark add-new","aria-label":"Add New",onClick:()=>this.goTo("/admin/listing/add")},i("ion-icon",{name:"add-circle"}))),this.loaded?i("div",{class:"listings",onScroll:t=>this.listingsScroll(t),style:{maxHeight:this.getTableHeight()},ref:t=>this.listingsWrapper=t},i("table",{class:"data-table"},i("thead",null,i("tr",null,i("th",null,i("button",{class:{"button-reset":!0,desc:"webid_desc"===this.searchParams.sortBy},onClick:()=>this.setSort("webid_desc"===this.searchParams.sortBy?"webid_asc":"webid_desc")},"Web Id ",i("ion-icon",{src:"/assets/images/icons/page_sort_arrow.svg"}))),i("th",{class:"mobile-only"},"Info"),i("th",{class:"desktop-only"},i("button",{class:{"button-reset":!0,desc:"last_updated_desc"===this.searchParams.sortBy},onClick:()=>this.setSort("last_updated_desc"===this.searchParams.sortBy?"last_updated_asc":"last_updated_desc")},"Last Updated",i("ion-icon",{src:"/assets/images/icons/page_sort_arrow.svg"}))),i("th",{class:"desktop-only"},"Status"),i("th",{class:"desktop-only"},i("button",{class:{"button-reset":!0,desc:"owner_desc"===this.searchParams.sortBy},onClick:()=>this.setSort("owner_desc"===this.searchParams.sortBy?"owner_asc":"owner_desc")},"Owner",i("ion-icon",{src:"/assets/images/icons/page_sort_arrow.svg"}))),i("th",{class:"desktop-only"},"Address"),i("th",{class:"desktop-only"},"APT#"),i("th",{class:"desktop-only"},i("button",{class:{"button-reset":!0,desc:"bedrooms_desc"===this.searchParams.sortBy},onClick:()=>this.setSort("bedrooms_desc"===this.searchParams.sortBy?"bedrooms_asc":"bedrooms_desc")},"BR",i("ion-icon",{src:"/assets/images/icons/page_sort_arrow.svg"}))),i("th",{class:"desktop-only"},i("button",{class:{"button-reset":!0,desc:"bathrooms_desc"===this.searchParams.sortBy},onClick:()=>this.setSort("bathrooms_desc"===this.searchParams.sortBy?"bathrooms_asc":"bathrooms_desc")},"Bath",i("ion-icon",{src:"/assets/images/icons/page_sort_arrow.svg"}))),i("th",{class:"desktop-only"},i("button",{class:{"button-reset":!0,desc:"availability_desc"===this.searchParams.sortBy},onClick:()=>this.setSort("availability_desc"===this.searchParams.sortBy?"availability_asc":"availability_desc")},"Availability",i("ion-icon",{src:"/assets/images/icons/page_sort_arrow.svg"}))),i("th",{class:"desktop-only"},i("button",{class:{"button-reset":!0,desc:"price_desc"===this.searchParams.sortBy},onClick:()=>this.setSort("price_desc"===this.searchParams.sortBy?"price_asc":"price_desc")},"Price",i("ion-icon",{src:"/assets/images/icons/page_sort_arrow.svg"}))),[...Array(12).keys()].map(t=>{const s=new Date((new Date).setDate(1)).setMonth(t);return i("th",{class:"desktop-only"},i("button",{class:{"button-reset":!0,desc:"price_month_desc"===this.searchParams.sortBy&&this.searchParams.price_month===t},onClick:()=>this.setSort("price_month_desc"===this.searchParams.sortBy?"price_month_asc":"price_month_desc",t)},l(s,"MMM"),i("ion-icon",{src:"/assets/images/icons/page_sort_arrow.svg"})))}),i("th",{class:"desktop-only"},"Featured 1"),i("th",{class:"desktop-only"},"Featured 2"),i("th",{class:"desktop-only"},"Featured 3"),i("th",null,"Action"))),i("tbody",null,this.listings.map(t=>{const s=d.getBedroomTypeById(t.bedroom_type_id,this.bedroomTypes);return i("tr",null,i("td",null,t.id),i("td",{class:"mobile-only"},i("div",null,t.apartment_number?t.apartment_number+" ":"",t.address),s?i("div",null,"BD: ",s.name):"",i("div",null,"BA: ",t.bathrooms),i("div",null,c(t.rate)),i("div",null,l(t.available_date))),i("td",{class:"desktop-only"},l(t.updated_at)),i("td",{class:"desktop-only"},i("button",{class:{"button-dark":!0,inactive:!t.is_active},onClick:()=>this.toggleBoolean(t,"is_active")},t.is_active?"Active":"Inactive")),i("td",null,t.owner_name),i("td",{class:"desktop-only"},t.address),i("td",{class:"desktop-only"},t.apartment_number),i("td",{class:"desktop-only"},s?s.name:""),i("td",{class:"desktop-only"},t.bathrooms),i("td",{class:"desktop-only"},this.formFocus===`available_date-${t.id}`?i("listing-availability-form",{item:t,onUpdateSuccess:t=>this.updateApt(t.detail)}):i("button",{class:"button-reset",onClick:()=>this.formFocus=`available_date-${t.id}`},l(t.available_date))),i("td",{class:"desktop-only"},c(t.rate)),[...new Array(12).keys()].map(s=>i("td",{class:"desktop-only"},this.formFocus===`monthly_rate-${t.id}-${s}`?i("listing-monthly-rate-form",{item:t,month:s,onUpdateSuccess:t=>this.updateApt(t.detail)}):i("button",{class:"button-reset",onClick:()=>this.formFocus=`monthly_rate-${t.id}-${s}`},c(t.rates.find(t=>t.month==s).monthly_rate)))),i("td",{class:"desktop-only"},i("button",{class:{"button-dark":!0,inactive:!t.feature_1},onClick:()=>this.toggleBoolean(t,"feature_1")},t.feature_1?"On":"Off")),i("td",{class:"desktop-only"},i("button",{class:{"button-dark":!0,inactive:!t.feature_2},onClick:()=>this.toggleBoolean(t,"feature_2")},t.feature_2?"On":"Off")),i("td",{class:"desktop-only"},i("button",{class:{"button-dark":!0,inactive:!t.feature_3},onClick:()=>this.toggleBoolean(t,"feature_3")},t.feature_3?"On":"Off")),i("td",{class:"no-wrap"},i("button",{class:"button-dark",onClick:()=>this.deleteListing(t.id)},i("ion-icon",{name:"trash"})),i("button",{class:"button-dark",onClick:()=>this.goTo(`/admin/listing/edit/${t.id}`)},i("ion-icon",{name:"settings"})),i("div",{class:"toggle-active"},i("button",{class:"button-dark",onClick:()=>this.toggleBoolean(t,"is_active")},t.is_active?"Active":"Inactive"))))})))):i("div",{class:"text-center"},i("ion-spinner",{name:"lines"}))))]}get el(){return e(this)}static get style(){return".page-admin-listings .listings{margin-top:32px;padding-bottom:32px;max-height:500px;overflow:auto}.page-admin-listings .listings .data-table thead th{position:-webkit-sticky;position:sticky;top:0;background-color:#fff;white-space:nowrap;padding-right:8px}.page-admin-listings .listings .data-table thead th button{font-weight:inherit}.page-admin-listings .listings .data-table thead th button.desc ion-icon{-webkit-transform:rotate(180deg);transform:rotate(180deg)}.page-admin-listings .listings .data-table thead th ion-icon{font-size:12px;margin-left:4px}.page-admin-listings .listings .data-table td{white-space:nowrap;background-color:#fff}.page-admin-listings button.button-dark.inactive{background-color:#888}.page-admin-listings button.button-dark.active-filter{margin-right:8px}.page-admin-listings .listings-totals{margin-top:-40px;padding-bottom:8px}.page-admin-listings .search{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center}.page-admin-listings .search .search-submit svg{width:1rem;height:1rem}.page-admin-listings .search button{height:48px}.page-admin-listings .add-new{margin-left:4px;font-size:18px}.page-admin-listings .toggle-active{padding-top:4px}\@media (min-width:1200px){.page-admin-listings .toggle-active{display:none}}"}};!function(t,s,i,e){var a,o=arguments.length,n=o<3?s:null===e?e=Object.getOwnPropertyDescriptor(s,i):e;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,s,i,e);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(n=(o<3?a(n):o>3?a(s,i,n):a(s,i))||n);o>3&&n&&Object.defineProperty(s,i,n)}([n(100)],m.prototype,"listingsScroll",null);export{m as page_admin_listings};