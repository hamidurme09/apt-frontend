import{r as e,c as t,h as s}from"./p-f5b6b644.js";import"./p-19ec51eb.js";import"./p-811a61b7.js";import"./p-74149bb1.js";import{a as r}from"./p-5444f5ad.js";import{R as i}from"./p-9d127c97.js";import{D as a}from"./p-82599b58.js";import{a as l}from"./p-08706a58.js";import{T as n}from"./p-2c007f74.js";import{A as o}from"./p-5908b5da.js";import{s as c}from"./p-4c12f224.js";import{A as h}from"./p-ecdfa480.js";const d=class{constructor(s){e(this,s),this.isAdmin=!1,this.isLoggedIn=!1,this.pageSize=40,this.loaded=!1,this.referrals=[],this.searchParams={query:"",sortBy:"created_date_desc",offset:0,limit:this.pageSize},this.resultCount=0,this.store=t(this,"store")}componentWillLoad(){this.store.mapStateToProps(this,e=>({isLoggedIn:r.isLoggedIn(e),isAdmin:r.isAdmin(e),screenHeight:c.getHeight(e)})),this.isLoggedIn?this.isAdmin||i.forward("/"):i.forward("/login")}componentDidLoad(){this.renderReferrals()}componentDidRender(){requestAnimationFrame(()=>{this.referralsWrapper&&(this.referralsWrapper.style.maxHeight=this.getTableHeight())})}async renderReferrals(){try{const e=await this.fetchReferrals();this.referrals=e.results,this.resultCount=e.total,this.loaded=!0}catch(e){n.error(e.message)}}async fetchReferrals(){try{return await o.getReferrals(this.searchParams)}catch(e){return n.error(`Could not retrieve referrals: ${e.message}`)}}search(e){e&&e.preventDefault(),this.searchInput.value!==this.searchParams.search_query&&(this.searchParams.query=this.searchInput.value),this.searchParams.offset=0,this.renderReferrals()}getTableHeight(){return this.referralsWrapper?`${this.screenHeight-this.referralsWrapper.offsetTop-150}px`:"500px"}async infiniteScroll(){this.searchParams.offset=this.referrals.length;try{const e=await this.fetchReferrals();e.results&&(this.referrals=[...this.referrals,...e.results])}catch(e){n.error(`Could not retrieve referrals: ${e.message}`)}}listingsScroll(e){e.target.scrollHeight-e.target.clientHeight-e.target.scrollTop>300||this.infiniteScroll()}setSort(e){this.searchParams=Object.assign(Object.assign({},this.searchParams),{sortBy:e}),this.search()}async deleteReferral(e){try{if(!await h.confirm("Deleting this is a permanent action, are you sure you want to delete the referral?","Are you sure?"))return;const t=await o.deleteReferral(e);if(t.success){const t=this.referrals.filter(t=>t.id!==e);this.referrals=t,n.success("Referral has been deleted")}else{if(t.errors)return void n.error(t.errors.join("\n"));t.message&&n.error(t.message)}}catch(e){n.error(e.message)}}render(){return[s("admin-header",null),s("ion-content",{class:"page-admin-referrals"},s("h2",{class:"text-center"},"Referrals"),s("section",{class:"section full"},this.loaded?s("div",{class:"listings-totals text-right"},"Total Referrals: ",this.resultCount):null,s("form",{class:"search",onSubmit:e=>this.search(e)},s("label",{htmlFor:"admin-listing-search",class:"sr-only"},"Search"),s("input",{id:"admin-listing-search",type:"text",class:"apt212-input",name:"search_query",placeholder:"search",ref:e=>this.searchInput=e}),s("button",{type:"submit",class:"button-dark search-submit","aria-label":"Search"},s("svg",{class:"feather feather-search",viewBox:"0 0 25 24",version:"1.1"},s("g",{stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"},s("path",{d:"M24,21.1886008 L18.6803754,15.9186997 C19.949079,14.3099652 20.6588954,12.3179013 20.6588954,10.238277 C20.6588954,5.14393658 16.472729,1 11.3303363,1 C6.18621089,1 2,5.14393658 2,10.238277 C2,15.3308573 6.18616646,19.4765539 11.3303363,19.4765539 C13.3071236,19.4765539 15.2318387,18.8457674 16.8196842,17.7010588 L22.1704099,23 L24,21.1886008 Z M11.3302919,16.9140717 C7.61273046,16.9140717 4.58934605,13.9182757 4.58934605,10.238365 C4.58934605,6.55849823 7.61268603,3.56265825 11.3302919,3.56265825 C15.0461205,3.56265825 18.0694605,6.55845423 18.0694605,10.238365 C18.0694605,12.2063608 17.1982293,14.0643123 15.6796059,15.3379854 C14.4664401,16.3537734 12.9218251,16.9140717 11.3302919,16.9140717 Z",fill:"#ffffff"}))))),this.loaded?s("div",{class:"listings",onScroll:e=>this.listingsScroll(e),style:{maxHeight:this.getTableHeight()},ref:e=>this.referralsWrapper=e},s("table",{class:"data-table"},s("thead",null,s("tr",null,s("th",null,s("button",{class:{"button-reset":!0,desc:"referrer_name_desc"===this.searchParams.sortBy},onClick:()=>this.setSort("referrer_name_desc"===this.searchParams.sortBy?"referrer_name_asc":"referrer_name_desc")},"User Name ",s("ion-icon",{src:"/assets/images/icons/page_sort_arrow.svg"}))),s("th",null,s("button",{class:{"button-reset":!0,desc:"referrer_email_desc"===this.searchParams.sortBy},onClick:()=>this.setSort("referrer_email_desc"===this.searchParams.sortBy?"referrer_email_asc":"referrer_email_desc")},"User Email",s("ion-icon",{src:"/assets/images/icons/page_sort_arrow.svg"}))),s("th",null,"User Phone"),s("th",null,s("button",{class:{"button-reset":!0,desc:"referral_name_desc"===this.searchParams.sortBy},onClick:()=>this.setSort("referral_name_desc"===this.searchParams.sortBy?"referral_name_asc":"referral_name_desc")},"Referral Name",s("ion-icon",{src:"/assets/images/icons/page_sort_arrow.svg"}))),s("th",null,s("button",{class:{"button-reset":!0,desc:"referral_email_desc"===this.searchParams.sortBy},onClick:()=>this.setSort("referral_email_desc"===this.searchParams.sortBy?"referral_email_asc":"referral_email_desc")},"Referral Email",s("ion-icon",{src:"/assets/images/icons/page_sort_arrow.svg"}))),s("th",null,"Referral Phone"),s("th",null,s("button",{class:{"button-reset":!0,desc:"created_at_desc"===this.searchParams.sortBy},onClick:()=>this.setSort("created_at_desc"===this.searchParams.sortBy?"created_at_asc":"created_at_desc")},"Created",s("ion-icon",{src:"/assets/images/icons/page_sort_arrow.svg"}))),s("th",null,"Action"))),s("tbody",null,this.referrals.map(e=>s("tr",null,s("td",null,e.referrer_name),s("td",null,e.referrer_email),s("td",null,e.referrer_phone),s("td",null,e.referral_name),s("td",null,e.referral_email),s("td",null,e.referral_phone),s("td",null,l(e.created_at)),s("td",null,s("button",{class:"button-dark",onClick:()=>this.deleteReferral(e.id)},s("ion-icon",{name:"trash"})))))))):s("div",{class:"text-center"},s("ion-spinner",{name:"lines"}))))]}static get style(){return".page-admin-referrals .listings{margin-top:32px;padding-bottom:32px;max-height:500px;overflow:auto}.page-admin-referrals .listings .data-table thead th{position:-webkit-sticky;position:sticky;top:0;background-color:#fff;white-space:nowrap;padding-right:8px;z-index:1}.page-admin-referrals .listings .data-table thead th button{font-weight:inherit}.page-admin-referrals .listings .data-table thead th button.desc ion-icon{-webkit-transform:rotate(180deg);transform:rotate(180deg)}.page-admin-referrals .listings .data-table thead th ion-icon{font-size:12px;margin-left:4px}.page-admin-referrals .listings .data-table td{white-space:nowrap;border-left:1px solid #d8d8d8;background-color:#fff}.page-admin-referrals button.button-dark.inactive{background-color:#888}.page-admin-referrals button.button-dark.active-filter{margin-right:8px}.page-admin-referrals .listings-totals{margin-top:-40px;padding-bottom:8px}.page-admin-referrals .search{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center}.page-admin-referrals .search .search-submit svg{width:1rem;height:1rem}.page-admin-referrals .search button{height:48px}"}};!function(e,t,s,r){var i,a=arguments.length,l=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,s,r);else for(var n=e.length-1;n>=0;n--)(i=e[n])&&(l=(a<3?i(l):a>3?i(t,s,l):i(t,s))||l);a>3&&l&&Object.defineProperty(t,s,l)}([a(100)],d.prototype,"listingsScroll",null);export{d as page_admin_referrals};