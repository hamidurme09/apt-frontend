var __awaiter=this&&this.__awaiter||function(e,r,t,s){function n(e){return e instanceof t?e:new t((function(r){r(e)}))}return new(t||(t=Promise))((function(t,a){function i(e){try{l(s.next(e))}catch(e){a(e)}}function o(e){try{l(s["throw"](e))}catch(e){a(e)}}function l(e){e.done?t(e.value):n(e.value).then(i,o)}l((s=s.apply(e,r||[])).next())}))};var __generator=this&&this.__generator||function(e,r){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},s,n,a,i;return i={next:o(0),throw:o(1),return:o(2)},typeof Symbol==="function"&&(i[Symbol.iterator]=function(){return this}),i;function o(e){return function(r){return l([e,r])}}function l(i){if(s)throw new TypeError("Generator is already executing.");while(t)try{if(s=1,n&&(a=i[0]&2?n["return"]:i[0]?n["throw"]||((a=n["return"])&&a.call(n),0):n.next)&&!(a=a.call(n,i[1])).done)return a;if(n=0,a)i=[i[0]&2,a.value];switch(i[0]){case 0:case 1:a=i;break;case 4:t.label++;return{value:i[1],done:false};case 5:t.label++;n=i[1];i=[0];continue;case 7:i=t.ops.pop();t.trys.pop();continue;default:if(!(a=t.trys,a=a.length>0&&a[a.length-1])&&(i[0]===6||i[0]===2)){t=0;continue}if(i[0]===3&&(!a||i[1]>a[0]&&i[1]<a[3])){t.label=i[1];break}if(i[0]===6&&t.label<a[1]){t.label=a[1];a=i;break}if(a&&t.label<a[2]){t.label=a[2];t.ops.push(i);break}if(a[2])t.ops.pop();t.trys.pop();continue}i=r.call(e,t)}catch(e){i=[6,e];n=0}finally{s=a=0}if(i[0]&5)throw i[1];return{value:i[0]?i[1]:void 0,done:true}}};var __spreadArrays=this&&this.__spreadArrays||function(){for(var e=0,r=0,t=arguments.length;r<t;r++)e+=arguments[r].length;for(var s=Array(e),n=0,r=0;r<t;r++)for(var a=arguments[r],i=0,o=a.length;i<o;i++,n++)s[n]=a[i];return s};System.register(["./p-c9001ae9.system.js","./p-69f5d316.system.js","./p-32fd337e.system.js","./p-50f9a219.system.js","./p-57233c53.system.js","./p-a55517c8.system.js","./p-de762d09.system.js","./p-5ad401ce.system.js","./p-2a28951d.system.js","./p-94e7dad5.system.js","./p-905fd021.system.js","./p-86739eb0.system.js"],(function(e){"use strict";var r,t,s,n,a,i,o,l,c,u,f;return{setters:[function(e){r=e.r;t=e.c;s=e.h},function(){},function(){},function(){},function(e){n=e.a},function(e){a=e.R},function(e){i=e.D},function(e){o=e.a},function(e){l=e.T},function(e){c=e.A},function(e){u=e.s},function(e){f=e.A}],execute:function(){var h=undefined&&undefined.__decorate||function(e,r,t,s){var n=arguments.length,a=n<3?r:s===null?s=Object.getOwnPropertyDescriptor(r,t):s,i;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")a=Reflect.decorate(e,r,t,s);else for(var o=e.length-1;o>=0;o--)if(i=e[o])a=(n<3?i(a):n>3?i(r,t,a):i(r,t))||a;return n>3&&a&&Object.defineProperty(r,t,a),a};var d=e("page_admin_referrals",function(){function e(e){r(this,e);this.isAdmin=false;this.isLoggedIn=false;this.pageSize=40;this.loaded=false;this.referrals=[];this.searchParams={query:"",sortBy:"created_date_desc",offset:0,limit:this.pageSize};this.resultCount=0;this.store=t(this,"store")}e.prototype.componentWillLoad=function(){this.store.mapStateToProps(this,(function(e){return{isLoggedIn:n.isLoggedIn(e),isAdmin:n.isAdmin(e),screenHeight:u.getHeight(e)}}));if(!this.isLoggedIn){a.forward("/login")}else{if(!this.isAdmin){a.forward("/")}}};e.prototype.componentDidLoad=function(){this.renderReferrals()};e.prototype.componentDidRender=function(){var e=this;requestAnimationFrame((function(){if(e.referralsWrapper){e.referralsWrapper.style.maxHeight=e.getTableHeight()}}))};e.prototype.renderReferrals=function(){return __awaiter(this,void 0,void 0,(function(){var e,r;return __generator(this,(function(t){switch(t.label){case 0:t.trys.push([0,2,,3]);return[4,this.fetchReferrals()];case 1:e=t.sent();this.referrals=e.results;this.resultCount=e.total;this.loaded=true;return[3,3];case 2:r=t.sent();l.error(r.message);return[3,3];case 3:return[2]}}))}))};e.prototype.fetchReferrals=function(){return __awaiter(this,void 0,void 0,(function(){var e,r;return __generator(this,(function(t){switch(t.label){case 0:t.trys.push([0,2,,3]);return[4,c.getReferrals(this.searchParams)];case 1:e=t.sent();return[2,e];case 2:r=t.sent();return[2,l.error("Could not retrieve referrals: "+r.message)];case 3:return[2]}}))}))};e.prototype.search=function(e){if(e){e.preventDefault()}if(this.searchInput.value!==this.searchParams.search_query){this.searchParams.query=this.searchInput.value}this.searchParams.offset=0;this.renderReferrals()};e.prototype.getTableHeight=function(){if(!this.referralsWrapper){return"500px"}return this.screenHeight-this.referralsWrapper.offsetTop-150+"px"};e.prototype.infiniteScroll=function(){return __awaiter(this,void 0,void 0,(function(){var e,r;return __generator(this,(function(t){switch(t.label){case 0:this.searchParams.offset=this.referrals.length;t.label=1;case 1:t.trys.push([1,3,,4]);return[4,this.fetchReferrals()];case 2:e=t.sent();if(e.results){this.referrals=__spreadArrays(this.referrals,e.results)}return[3,4];case 3:r=t.sent();l.error("Could not retrieve referrals: "+r.message);return[3,4];case 4:return[2]}}))}))};e.prototype.listingsScroll=function(e){var r=e.target.scrollHeight-e.target.clientHeight-e.target.scrollTop;if(r>300){return}this.infiniteScroll()};e.prototype.setSort=function(e){this.searchParams=Object.assign(Object.assign({},this.searchParams),{sortBy:e});this.search()};e.prototype.deleteReferral=function(e){return __awaiter(this,void 0,void 0,(function(){var r,t,s;return __generator(this,(function(n){switch(n.label){case 0:n.trys.push([0,3,,4]);return[4,f.confirm("Deleting this is a permanent action, are you sure you want to delete the referral?","Are you sure?")];case 1:if(!n.sent()){return[2]}return[4,c.deleteReferral(e)];case 2:r=n.sent();if(r.success){t=this.referrals.filter((function(r){return r.id!==e}));this.referrals=t;l.success("Referral has been deleted")}else{if(r.errors){l.error(r.errors.join("\n"));return[2]}if(r.message){l.error(r.message)}}return[3,4];case 3:s=n.sent();l.error(s.message);return[3,4];case 4:return[2]}}))}))};e.prototype.render=function(){var e=this;return[s("admin-header",null),s("ion-content",{class:"page-admin-referrals"},s("h2",{class:"text-center"},"Referrals"),s("section",{class:"section full"},this.loaded?s("div",{class:"listings-totals text-right"},"Total Referrals: ",this.resultCount):null,s("form",{class:"search",onSubmit:function(r){return e.search(r)}},s("label",{htmlFor:"admin-listing-search",class:"sr-only"},"Search"),s("input",{id:"admin-listing-search",type:"text",class:"apt212-input",name:"search_query",placeholder:"search",ref:function(r){return e.searchInput=r}}),s("button",{type:"submit",class:"button-dark search-submit","aria-label":"Search"},s("svg",{class:"feather feather-search",viewBox:"0 0 25 24",version:"1.1"},s("g",{stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"},s("path",{d:"M24,21.1886008 L18.6803754,15.9186997 C19.949079,14.3099652 20.6588954,12.3179013 20.6588954,10.238277 C20.6588954,5.14393658 16.472729,1 11.3303363,1 C6.18621089,1 2,5.14393658 2,10.238277 C2,15.3308573 6.18616646,19.4765539 11.3303363,19.4765539 C13.3071236,19.4765539 15.2318387,18.8457674 16.8196842,17.7010588 L22.1704099,23 L24,21.1886008 Z M11.3302919,16.9140717 C7.61273046,16.9140717 4.58934605,13.9182757 4.58934605,10.238365 C4.58934605,6.55849823 7.61268603,3.56265825 11.3302919,3.56265825 C15.0461205,3.56265825 18.0694605,6.55845423 18.0694605,10.238365 C18.0694605,12.2063608 17.1982293,14.0643123 15.6796059,15.3379854 C14.4664401,16.3537734 12.9218251,16.9140717 11.3302919,16.9140717 Z",fill:"#ffffff"}))))),this.loaded?s("div",{class:"listings",onScroll:function(r){return e.listingsScroll(r)},style:{maxHeight:this.getTableHeight()},ref:function(r){return e.referralsWrapper=r}},s("table",{class:"data-table"},s("thead",null,s("tr",null,s("th",null,s("button",{class:{"button-reset":true,desc:this.searchParams.sortBy==="referrer_name_desc"},onClick:function(){return e.setSort(e.searchParams.sortBy==="referrer_name_desc"?"referrer_name_asc":"referrer_name_desc")}},"User Name ",s("ion-icon",{src:"/assets/images/icons/page_sort_arrow.svg"}))),s("th",null,s("button",{class:{"button-reset":true,desc:this.searchParams.sortBy==="referrer_email_desc"},onClick:function(){return e.setSort(e.searchParams.sortBy==="referrer_email_desc"?"referrer_email_asc":"referrer_email_desc")}},"User Email",s("ion-icon",{src:"/assets/images/icons/page_sort_arrow.svg"}))),s("th",null,"User Phone"),s("th",null,s("button",{class:{"button-reset":true,desc:this.searchParams.sortBy==="referral_name_desc"},onClick:function(){return e.setSort(e.searchParams.sortBy==="referral_name_desc"?"referral_name_asc":"referral_name_desc")}},"Referral Name",s("ion-icon",{src:"/assets/images/icons/page_sort_arrow.svg"}))),s("th",null,s("button",{class:{"button-reset":true,desc:this.searchParams.sortBy==="referral_email_desc"},onClick:function(){return e.setSort(e.searchParams.sortBy==="referral_email_desc"?"referral_email_asc":"referral_email_desc")}},"Referral Email",s("ion-icon",{src:"/assets/images/icons/page_sort_arrow.svg"}))),s("th",null,"Referral Phone"),s("th",null,s("button",{class:{"button-reset":true,desc:this.searchParams.sortBy==="created_at_desc"},onClick:function(){return e.setSort(e.searchParams.sortBy==="created_at_desc"?"created_at_asc":"created_at_desc")}},"Created",s("ion-icon",{src:"/assets/images/icons/page_sort_arrow.svg"}))),s("th",null,"Action"))),s("tbody",null,this.referrals.map((function(r){return s("tr",null,s("td",null,r.referrer_name),s("td",null,r.referrer_email),s("td",null,r.referrer_phone),s("td",null,r.referral_name),s("td",null,r.referral_email),s("td",null,r.referral_phone),s("td",null,o(r.created_at)),s("td",null,s("button",{class:"button-dark",onClick:function(){return e.deleteReferral(r.id)}},s("ion-icon",{name:"trash"}))))}))))):s("div",{class:"text-center"},s("ion-spinner",{name:"lines"}))))]};Object.defineProperty(e,"style",{get:function(){return".page-admin-referrals .listings{margin-top:32px;padding-bottom:32px;max-height:500px;overflow:auto}.page-admin-referrals .listings .data-table thead th{position:-webkit-sticky;position:sticky;top:0;background-color:#fff;white-space:nowrap;padding-right:8px;z-index:1}.page-admin-referrals .listings .data-table thead th button{font-weight:inherit}.page-admin-referrals .listings .data-table thead th button.desc ion-icon{-webkit-transform:rotate(180deg);transform:rotate(180deg)}.page-admin-referrals .listings .data-table thead th ion-icon{font-size:12px;margin-left:4px}.page-admin-referrals .listings .data-table td{white-space:nowrap;border-left:1px solid #d8d8d8;background-color:#fff}.page-admin-referrals button.button-dark.inactive{background-color:#888}.page-admin-referrals button.button-dark.active-filter{margin-right:8px}.page-admin-referrals .listings-totals{margin-top:-40px;padding-bottom:8px}.page-admin-referrals .search{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center}.page-admin-referrals .search .search-submit svg{width:1rem;height:1rem}.page-admin-referrals .search button{height:48px}"},enumerable:true,configurable:true});return e}());h([i(100)],d.prototype,"listingsScroll",null)}}}));