var __awaiter=this&&this.__awaiter||function(t,e,i,r){function n(t){return t instanceof i?t:new i((function(e){e(t)}))}return new(i||(i=Promise))((function(i,s){function a(t){try{u(r.next(t))}catch(t){s(t)}}function o(t){try{u(r["throw"](t))}catch(t){s(t)}}function u(t){t.done?i(t.value):n(t.value).then(a,o)}u((r=r.apply(t,e||[])).next())}))};var __generator=this&&this.__generator||function(t,e){var i={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,n,s,a;return a={next:o(0),throw:o(1),return:o(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(t){return function(e){return u([t,e])}}function u(a){if(r)throw new TypeError("Generator is already executing.");while(i)try{if(r=1,n&&(s=a[0]&2?n["return"]:a[0]?n["throw"]||((s=n["return"])&&s.call(n),0):n.next)&&!(s=s.call(n,a[1])).done)return s;if(n=0,s)a=[a[0]&2,s.value];switch(a[0]){case 0:case 1:s=a;break;case 4:i.label++;return{value:a[1],done:false};case 5:i.label++;n=a[1];a=[0];continue;case 7:a=i.ops.pop();i.trys.pop();continue;default:if(!(s=i.trys,s=s.length>0&&s[s.length-1])&&(a[0]===6||a[0]===2)){i=0;continue}if(a[0]===3&&(!s||a[1]>s[0]&&a[1]<s[3])){i.label=a[1];break}if(a[0]===6&&i.label<s[1]){i.label=s[1];s=a;break}if(s&&i.label<s[2]){i.label=s[2];i.ops.push(a);break}if(s[2])i.ops.pop();i.trys.pop();continue}a=e.call(t,i)}catch(t){a=[6,t];n=0}finally{r=s=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var __spreadArrays=this&&this.__spreadArrays||function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;for(var r=Array(t),n=0,e=0;e<i;e++)for(var s=arguments[e],a=0,o=s.length;a<o;a++,n++)r[n]=s[a];return r};System.register(["./p-c9001ae9.system.js","./p-69f5d316.system.js","./p-32fd337e.system.js","./p-fb64dbc4.system.js","./p-50f9a219.system.js","./p-c57ab675.system.js","./p-4754297b.system.js","./p-5ad401ce.system.js","./p-f1f8d54f.system.js","./p-e1bea0ce.system.js","./p-523bf5f5.system.js","./p-70201690.system.js","./p-8a6f03fc.system.js","./p-2a28951d.system.js","./p-43b2f790.system.js","./p-94e7dad5.system.js"],(function(t){"use strict";var e,i,r,n,s,a,o,u,c,l,d,h,f,p,m;return{setters:[function(t){e=t.r;i=t.c;r=t.h},function(t){n=t.E},function(){},function(){},function(){},function(t){s=t.S},function(t){a=t.b},function(t){o=t.g},function(t){u=t.s},function(t){c=t.i},function(t){l=t.I},function(t){d=t.L},function(t){h=t.A},function(t){f=t.T},function(t){p=t.M},function(t){m=t.A}],execute:function(){var b=t("booking_form",function(){function t(t){e(this,t);this.method="ach";this.agent="yes";this.bookingDetails=null;this.errors=[];this.submitted=false;this.agents=[];this.idSuffix=o(5);this.plaidLoaded=false;this.store=i(this,"store")}t.prototype.fetchAgents=function(){return __awaiter(this,void 0,void 0,(function(){var t,e;return __generator(this,(function(i){switch(i.label){case 0:i.trys.push([0,2,,3]);return[4,m.getAgents()];case 1:t=i.sent();this.agents=t;return[2,t];case 2:e=i.sent();return[2,f.error("Could not retrieve agents. Please try again later. "+e.message)];case 3:return[2]}}))}))};t.prototype.componentWillLoad=function(){this.store.mapStateToProps(this,(function(t){return{bookingDetails:a.getBookingDetails(t)}}))};t.prototype.componentDidLoad=function(){var t=this;this.fetchAgents();s.loadScript("Stripe","https://js.stripe.com/v3/").then((function(){t.stripe=Stripe(n.getInstance().get("STRIPE_PUBLIC_KEY"));t.stripeElements=t.stripe.elements({fonts:[{cssSrc:"https://fonts.googleapis.com/css?family=Source+Sans+Pro"}]});t.stripeInit()})).catch((function(t){console.log(t)}));s.loadScript("Plaid","https://cdn.plaid.com/link/v2/stable/link-initialize.js").then((function(){t.plaidLoaded=true})).catch((function(t){console.log(t)}))};t.prototype.stripeInit=function(){var t={base:{fontFamily:"Source sans pro"}};try{if(!this.cardNumber){this.cardNumber=this.stripeElements.create("cardNumber",{style:t});this.cardNumber.addEventListener("change",(function(t){if(t.error){f.error(t.error.message)}}))}if(!this.cardExpiry){this.cardExpiry=this.stripeElements.create("cardExpiry",{style:t});this.cardExpiry.addEventListener("change",(function(t){if(t.error){f.error(t.error.message)}}))}if(!this.cardCvc){this.cardCvc=this.stripeElements.create("cardCvc",{style:t});this.cardCvc.addEventListener("change",(function(t){if(t.error){f.error(t.error.message)}}))}this.cardNumber.mount("#cardNumber-"+this.idSuffix);this.cardNumber.clear();this.cardExpiry.mount("#cardExpiry-"+this.idSuffix);this.cardCvc.mount("#cardCvc-"+this.idSuffix)}catch(t){console.log(t)}};t.prototype.onSubmit=function(t){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(i){t.preventDefault();e=u(this.form,{hash:true,empty:true});this.checkErrors(e);if(this.errors.length){return[2]}if(this.bookingDetails){e.bookingDetails=JSON.stringify(this.bookingDetails)}if(e.using_agent==="yes"){e.agentName=this.agents.filter((function(t){return t.email===e.agent})).map((function(t){return t.name}))[0]}if(e.payment_method=="credit"){this.processCreditCard(e)}else{this.processACH(e)}return[2]}))}))};t.prototype.checkErrors=function(t){var e=[];var i=["amount","webid","firstname","lastname","email","phone","tos"];if(t.payment_method==="credit"){i=__spreadArrays(i,["zipcode"])}if(this.agent==="yes"){i=__spreadArrays(i,["agent"])}i.forEach((function(i){if(!t[i]){e.push(i)}}));if(!c(t.amount)){e.push("amount")}if(!l.validate(t.email)){e.push("email")}if(t.payment_method==="credit"){if(this.cardNumber._empty||this.cardNumber._invalid){e.push("cardNumber")}if(this.cardExpiry._empty||this.cardExpiry._invalid){e.push("cardExpiry")}if(this.cardCvc._empty||this.cardExpiry._invalid){e.push("cardCvc")}}this.errors=e};t.prototype.processCreditCard=function(t){return __awaiter(this,void 0,void 0,(function(){var e,i,r;return __generator(this,(function(n){switch(n.label){case 0:return[4,d.showLoading()];case 1:n.sent();n.label=2;case 2:n.trys.push([2,6,,7]);return[4,h.getPaymentIntent(t)];case 3:e=n.sent();return[4,this.stripe.confirmCardPayment(e,{payment_method:{card:this.cardNumber,billing_details:{name:t.firstname+" "+t.lastname,email:t.email,address:{postal_code:t.zipcode}}}})];case 4:i=n.sent();if(i.error){throw new Error(i.error.message)}return[4,d.hideLoading()];case 5:n.sent();this.submitted=true;return[3,7];case 6:r=n.sent();f.error(r.message,{duration:1e4});return[3,7];case 7:return[4,d.hideLoading()];case 8:n.sent();return[2]}}))}))};t.prototype.processACH=function(t){return __awaiter(this,void 0,void 0,(function(){var e;var i=this;return __generator(this,(function(r){if(!this.plaidLoaded){f.error("Could not contact Plaid");return[2]}e=Plaid.create({env:n.getInstance().get("PLAID_ENVIRONMENT"),clientName:"APT212",key:n.getInstance().get("PLAID_PUBLIC_KEY"),product:["auth"],selectAccount:true,onSuccess:function(e,r){return __awaiter(i,void 0,void 0,(function(){var i,n;return __generator(this,(function(s){switch(s.label){case 0:return[4,d.showLoading()];case 1:s.sent();s.label=2;case 2:s.trys.push([2,5,,6]);return[4,h.checkoutACH(t,e,r.account_id)];case 3:i=s.sent();if(i.error){throw new Error(i.error.message)}return[4,d.hideLoading()];case 4:s.sent();this.submitted=true;return[3,6];case 5:n=s.sent();f.error(n.message,{duration:1e4});return[3,6];case 6:return[4,d.hideLoading()];case 7:s.sent();return[2]}}))}))},onExit:function(t,e){if(t!=null){f.error("Could not establish ACH authorization, please try again");return}f.error("ACH authorization has been cancelled")}});e.open();return[2]}))}))};t.prototype.render=function(){var t=this;return r("form",{onSubmit:function(e){return t.onSubmit(e)},class:"booking-form-component",ref:function(e){return t.form=e}},r("div",{class:{"form-content":true,submitted:this.submitted}},r("div",{class:"title text-center"},"Select a payment method"),r("div",{class:"payment-method text-center"},r("div",{class:"button-toggles"},r("button",{type:"button",class:{"button-dark":true,active:this.method==="ach"},onClick:function(){return t.method="ach"}},r("img",{src:"/assets/images/icons/bank_transfer_"+(this.method==="ach"?"white":"black")+".svg",alt:"",class:"payment-method-icon"}),"Bank Transfer")),r("div",{class:"button-toggles"},r("button",{type:"button",class:{"button-dark":true,active:this.method==="credit"},onClick:function(){return t.method="credit"}},r("img",{src:"/assets/images/icons/credit_card_"+(this.method==="credit"?"white":"black")+".svg",alt:"",class:"payment-method-icon"}),"Credit Card"),r("div",{class:"subtext"},"* Additional 3% for processing fees")),r("input",{type:"hidden",name:"payment_method",value:this.method})),r("div",{class:"default-fields"},r("div",{class:{input:true,error:this.errors.includes("amount")}},r("label",{htmlFor:"amount-"+this.idSuffix},"Amount you would like to pay"),r("input",{id:"amount-"+this.idSuffix,type:"number",name:"amount",value:this.bookingDetails?this.bookingDetails.timeline.due_to_reserve:null,step:"0.01"})),r("div",{class:{input:true,error:this.errors.includes("webid")}},r("label",{htmlFor:"webid-"+this.idSuffix},"Address or Web ID"),r("input",{id:"webid-"+this.idSuffix,type:"text",name:"webid",value:this.bookingDetails?this.bookingDetails.id:null})),r("div",{class:"columns"},r("div",{class:"input agent"},r("label",null,"Working with an agent?"),r("div",{class:"button-toggles"},r("button",{type:"button",class:{"button-dark":true,active:this.agent==="yes"},onClick:function(){return t.agent="yes"}},"Yes"),r("button",{type:"button",class:{"button-dark":true,active:this.agent==="no"},onClick:function(){return t.agent="no"}},"No")),r("input",{type:"hidden",name:"using_agent",value:this.agent})),r("div",{class:{input:true,error:this.errors.includes("agent")}},this.agent==="yes"?r("div",null,r("label",{htmlFor:"agent-"+this.idSuffix},"Agent Name"),r("select",{id:"agent-"+this.idSuffix,name:"agent"},this.agents.map((function(t){return r("option",{value:t.email},t.name)})))):null),r("div",{class:{input:true,error:this.errors.includes("firstname")}},r("label",{htmlFor:"firstname-"+this.idSuffix},"First Name"),r("input",{id:"firstname-"+this.idSuffix,type:"text",name:"firstname"})),r("div",{class:{input:true,error:this.errors.includes("lastname")}},r("label",{htmlFor:"lastname-"+this.idSuffix},"Last Name"),r("input",{id:"lastname-"+this.idSuffix,type:"text",name:"lastname"})),r("div",{class:{input:true,error:this.errors.includes("email")}},r("label",{htmlFor:"email-"+this.idSuffix},"Email"),r("input",{id:"email-"+this.idSuffix,type:"email",name:"email"})),r("div",{class:{input:true,error:this.errors.includes("phone")}},r("label",{htmlFor:"phone-"+this.idSuffix},"Phone"),r("input",{id:"phone-"+this.idSuffix,type:"text",name:"phone"})))),r("div",{class:{"credit-inputs":true,visible:this.method==="credit"}},r("div",{class:{input:true,error:this.errors.includes("cardNumber")}},r("label",null,"Credit Card Number"),r("div",{id:"cardNumber-"+this.idSuffix,class:"stripe-input"})),r("div",{class:"columns"},r("div",{class:{input:true,error:this.errors.includes("zipcode")}},r("label",null,"Zip/Postal Code"),r("input",{id:"zipcode-"+this.idSuffix,type:"text",name:"zipcode"})),r("div",{class:"columns"},r("div",{class:{input:true,error:this.errors.includes("cardExpiry")}},r("label",null,"Exp Date"),r("div",{id:"cardExpiry-"+this.idSuffix,class:"stripe-input"})),r("div",{class:{input:true,error:this.errors.includes("cardCvc")}},r("label",null,"CVC"),r("div",{id:"cardCvc-"+this.idSuffix,class:"stripe-input"}))))),r("div",{class:{input:true,error:this.errors.includes("tos")}},r("div",{class:"flex-vertical-center"},r("label",{class:"inline"},"I have read and agree to the terms & conditions of service"),r("apt212-checkbox",{name:"tos",value:"1",class:"tos"}),r("button",{type:"button",class:"button-reset tos-view",onClick:function(){return p.bookingTOS()}},"View"))),r("div",{class:"input"},r("button",{type:"submit",class:"button button-dark block active"},"Proceed to payment gateway"))),this.submitted?r("div",{class:"thank-you-msg flex-vertical-center text-center"},r("div",null,r("p",null,"Your payment has been processed successfully! ",r("br",null),r("br",null),"We are now processing your booking and will email you shortly with the next steps."),r("ion-icon",{name:"md-checkmark"}))):null)};Object.defineProperty(t,"style",{get:function(){return".booking-form-component .title{font-size:14px;font-weight:600}.booking-form-component button{border-radius:6px;font-size:12px}.booking-form-component button:focus{outline:none}.booking-form-component .form-content.submitted{visibility:hidden}.booking-form-component .payment-method{padding-top:16px;display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center}.booking-form-component .payment-method>div:not(:first-child){margin-left:12px}.booking-form-component .payment-method .subtext{padding-top:5px;font-size:8px;font-weight:600}.booking-form-component .button-toggles button{display:-ms-inline-flexbox;display:inline-flex;-ms-flex-pack:center;justify-content:center;-ms-flex-align:center;align-items:center;border:1px solid #000;height:44px;background-color:#fff;color:#000;width:123px;padding:0}\@media (min-width:1200px){.booking-form-component .button-toggles button{width:157px;font-size:14px}}.booking-form-component .button-toggles button.active{background-color:#000;color:#fff}.booking-form-component .payment-method-icon{display:inline-block;width:16px;margin-right:8px}.booking-form-component .agent button{height:32px;width:auto;padding:0;width:50%}.booking-form-component .agent button:first-child{border-top-right-radius:0;border-bottom-right-radius:0}.booking-form-component .agent button:last-child{border-top-left-radius:0;border-bottom-left-radius:0}.booking-form-component label{font-size:10px;opacity:.8;font-weight:600;display:block;padding-bottom:6px}.booking-form-component label.inline{display:inline}.booking-form-component .error label{color:red}.booking-form-component .stripe-input,.booking-form-component input,.booking-form-component input[type=email],.booking-form-component input[type=number],.booking-form-component select{height:32px;border-radius:6px;border:1px solid rgba(0,0,0,.5);background-color:#fff;width:100%}.booking-form-component .error .stripe-input,.booking-form-component .error input,.booking-form-component .error input[type=email],.booking-form-component .error input[type=number],.booking-form-component .error select{border:1px solid red}.booking-form-component .columns{display:grid;grid-template-columns:repeat(2,1fr)}.booking-form-component .columns>:nth-child(odd){margin-right:5px}.booking-form-component .columns>:nth-child(2n){margin-left:5px}.booking-form-component .tos{display:inline-block;margin-left:10px;padding-bottom:3px;--apt212-checkbox-border:1px solid #000;--apt212-checkbox-border-radius:2px}.booking-form-component .tos label{padding:0}.booking-form-component .error .tos{--apt212-checkbox-border:1px solid red}.booking-form-component .tos-view{font-size:10px;text-decoration:underline;font-weight:700}.booking-form-component .stripe-input{padding-top:6px;padding-left:4px}.booking-form-component .credit-inputs{display:none}.booking-form-component .credit-inputs.visible{display:block}.booking-form-component .thank-you-msg{position:absolute;top:0;left:0;width:100%;height:100%;-ms-flex-pack:center;justify-content:center}.booking-form-component .thank-you-msg p{font-size:24px;font-weight:700;line-height:1.5;padding:0 40px}.booking-form-component .thank-you-msg ion-icon{font-size:120px;color:#057365}.booking-form-component .tos-view{padding-bottom:6px}.booking-form-component .main-content{position:relative}.booking-form-component .main-content.hide{visibility:hidden}"},enumerable:true,configurable:true});return t}())}}}));