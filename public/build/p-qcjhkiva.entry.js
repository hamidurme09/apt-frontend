import{r as t,c as s,h as i}from"./p-f5b6b644.js";import{E as e}from"./p-19ec51eb.js";import"./p-811a61b7.js";import"./p-30f68cd2.js";import"./p-74149bb1.js";import{S as a}from"./p-980b9778.js";import{b as n}from"./p-ca0e51b7.js";import{g as o}from"./p-08706a58.js";import{s as r}from"./p-c041151f.js";import{i as l}from"./p-0850846a.js";import{I as c}from"./p-283e4737.js";import{L as h}from"./p-9d50b311.js";import{A as d}from"./p-2351c48a.js";import{T as m}from"./p-2c007f74.js";import{M as p}from"./p-d40f2c8b.js";import{A as u}from"./p-5908b5da.js";const b=class{constructor(i){t(this,i),this.method="ach",this.agent="yes",this.bookingDetails=null,this.errors=[],this.submitted=!1,this.agents=[],this.idSuffix=o(5),this.plaidLoaded=!1,this.store=s(this,"store")}async fetchAgents(){try{const t=await u.getAgents();return this.agents=t,t}catch(t){return m.error(`Could not retrieve agents. Please try again later. ${t.message}`)}}componentWillLoad(){this.store.mapStateToProps(this,t=>({bookingDetails:n.getBookingDetails(t)}))}componentDidLoad(){this.fetchAgents(),a.loadScript("Stripe","https://js.stripe.com/v3/").then(()=>{this.stripe=Stripe(e.getInstance().get("STRIPE_PUBLIC_KEY")),this.stripeElements=this.stripe.elements({fonts:[{cssSrc:"https://fonts.googleapis.com/css?family=Source+Sans+Pro"}]}),this.stripeInit()}).catch(t=>{console.log(t)}),a.loadScript("Plaid","https://cdn.plaid.com/link/v2/stable/link-initialize.js").then(()=>{this.plaidLoaded=!0}).catch(t=>{console.log(t)})}stripeInit(){const t={base:{fontFamily:"Source sans pro"}};try{this.cardNumber||(this.cardNumber=this.stripeElements.create("cardNumber",{style:t}),this.cardNumber.addEventListener("change",t=>{t.error&&m.error(t.error.message)})),this.cardExpiry||(this.cardExpiry=this.stripeElements.create("cardExpiry",{style:t}),this.cardExpiry.addEventListener("change",t=>{t.error&&m.error(t.error.message)})),this.cardCvc||(this.cardCvc=this.stripeElements.create("cardCvc",{style:t}),this.cardCvc.addEventListener("change",t=>{t.error&&m.error(t.error.message)})),this.cardNumber.mount(`#cardNumber-${this.idSuffix}`),this.cardNumber.clear(),this.cardExpiry.mount(`#cardExpiry-${this.idSuffix}`),this.cardCvc.mount(`#cardCvc-${this.idSuffix}`)}catch(t){console.log(t)}}async onSubmit(t){t.preventDefault();let s=r(this.form,{hash:!0,empty:!0});this.checkErrors(s),this.errors.length||(this.bookingDetails&&(s.bookingDetails=JSON.stringify(this.bookingDetails)),"yes"===s.using_agent&&(s.agentName=this.agents.filter(t=>t.email===s.agent).map(t=>t.name)[0]),"credit"==s.payment_method?this.processCreditCard(s):this.processACH(s))}checkErrors(t){const s=[];let i=["amount","webid","firstname","lastname","email","phone","tos"];"credit"===t.payment_method&&(i=[...i,"zipcode"]),"yes"===this.agent&&(i=[...i,"agent"]),i.forEach(i=>{t[i]||s.push(i)}),l(t.amount)||s.push("amount"),c.validate(t.email)||s.push("email"),"credit"===t.payment_method&&((this.cardNumber._empty||this.cardNumber._invalid)&&s.push("cardNumber"),(this.cardExpiry._empty||this.cardExpiry._invalid)&&s.push("cardExpiry"),(this.cardCvc._empty||this.cardExpiry._invalid)&&s.push("cardCvc")),this.errors=s}async processCreditCard(t){await h.showLoading();try{const s=await d.getPaymentIntent(t),i=await this.stripe.confirmCardPayment(s,{payment_method:{card:this.cardNumber,billing_details:{name:`${t.firstname} ${t.lastname}`,email:t.email,address:{postal_code:t.zipcode}}}});if(i.error)throw new Error(i.error.message);await h.hideLoading(),this.submitted=!0}catch(t){m.error(t.message,{duration:1e4})}await h.hideLoading()}async processACH(t){this.plaidLoaded?Plaid.create({env:e.getInstance().get("PLAID_ENVIRONMENT"),clientName:"APT212",key:e.getInstance().get("PLAID_PUBLIC_KEY"),product:["auth"],selectAccount:!0,onSuccess:async(s,i)=>{await h.showLoading();try{const e=await d.checkoutACH(t,s,i.account_id);if(e.error)throw new Error(e.error.message);await h.hideLoading(),this.submitted=!0}catch(t){m.error(t.message,{duration:1e4})}await h.hideLoading()},onExit:t=>{m.error(null==t?"ACH authorization has been cancelled":"Could not establish ACH authorization, please try again")}}).open():m.error("Could not contact Plaid")}render(){return i("form",{onSubmit:t=>this.onSubmit(t),class:"booking-form-component",ref:t=>this.form=t},i("div",{class:{"form-content":!0,submitted:this.submitted}},i("div",{class:"title text-center"},"Select a payment method"),i("div",{class:"payment-method text-center"},i("div",{class:"button-toggles"},i("button",{type:"button",class:{"button-dark":!0,active:"ach"===this.method},onClick:()=>this.method="ach"},i("img",{src:`/assets/images/icons/bank_transfer_${"ach"===this.method?"white":"black"}.svg`,alt:"",class:"payment-method-icon"}),"Bank Transfer")),i("div",{class:"button-toggles"},i("button",{type:"button",class:{"button-dark":!0,active:"credit"===this.method},onClick:()=>this.method="credit"},i("img",{src:`/assets/images/icons/credit_card_${"credit"===this.method?"white":"black"}.svg`,alt:"",class:"payment-method-icon"}),"Credit Card"),i("div",{class:"subtext"},"* Additional 3% for processing fees")),i("input",{type:"hidden",name:"payment_method",value:this.method})),i("div",{class:"default-fields"},i("div",{class:{input:!0,error:this.errors.includes("amount")}},i("label",{htmlFor:`amount-${this.idSuffix}`},"Amount you would like to pay"),i("input",{id:`amount-${this.idSuffix}`,type:"number",name:"amount",value:this.bookingDetails?this.bookingDetails.timeline.due_to_reserve:null,step:"0.01"})),i("div",{class:{input:!0,error:this.errors.includes("webid")}},i("label",{htmlFor:`webid-${this.idSuffix}`},"Address or Web ID"),i("input",{id:`webid-${this.idSuffix}`,type:"text",name:"webid",value:this.bookingDetails?this.bookingDetails.id:null})),i("div",{class:"columns"},i("div",{class:"input agent"},i("label",null,"Working with an agent?"),i("div",{class:"button-toggles"},i("button",{type:"button",class:{"button-dark":!0,active:"yes"===this.agent},onClick:()=>this.agent="yes"},"Yes"),i("button",{type:"button",class:{"button-dark":!0,active:"no"===this.agent},onClick:()=>this.agent="no"},"No")),i("input",{type:"hidden",name:"using_agent",value:this.agent})),i("div",{class:{input:!0,error:this.errors.includes("agent")}},"yes"===this.agent?i("div",null,i("label",{htmlFor:`agent-${this.idSuffix}`},"Agent Name"),i("select",{id:`agent-${this.idSuffix}`,name:"agent"},this.agents.map(t=>i("option",{value:t.email},t.name)))):null),i("div",{class:{input:!0,error:this.errors.includes("firstname")}},i("label",{htmlFor:`firstname-${this.idSuffix}`},"First Name"),i("input",{id:`firstname-${this.idSuffix}`,type:"text",name:"firstname"})),i("div",{class:{input:!0,error:this.errors.includes("lastname")}},i("label",{htmlFor:`lastname-${this.idSuffix}`},"Last Name"),i("input",{id:`lastname-${this.idSuffix}`,type:"text",name:"lastname"})),i("div",{class:{input:!0,error:this.errors.includes("email")}},i("label",{htmlFor:`email-${this.idSuffix}`},"Email"),i("input",{id:`email-${this.idSuffix}`,type:"email",name:"email"})),i("div",{class:{input:!0,error:this.errors.includes("phone")}},i("label",{htmlFor:`phone-${this.idSuffix}`},"Phone"),i("input",{id:`phone-${this.idSuffix}`,type:"text",name:"phone"})))),i("div",{class:{"credit-inputs":!0,visible:"credit"===this.method}},i("div",{class:{input:!0,error:this.errors.includes("cardNumber")}},i("label",null,"Credit Card Number"),i("div",{id:`cardNumber-${this.idSuffix}`,class:"stripe-input"})),i("div",{class:"columns"},i("div",{class:{input:!0,error:this.errors.includes("zipcode")}},i("label",null,"Zip/Postal Code"),i("input",{id:`zipcode-${this.idSuffix}`,type:"text",name:"zipcode"})),i("div",{class:"columns"},i("div",{class:{input:!0,error:this.errors.includes("cardExpiry")}},i("label",null,"Exp Date"),i("div",{id:`cardExpiry-${this.idSuffix}`,class:"stripe-input"})),i("div",{class:{input:!0,error:this.errors.includes("cardCvc")}},i("label",null,"CVC"),i("div",{id:`cardCvc-${this.idSuffix}`,class:"stripe-input"}))))),i("div",{class:{input:!0,error:this.errors.includes("tos")}},i("div",{class:"flex-vertical-center"},i("label",{class:"inline"},"I have read and agree to the terms & conditions of service"),i("apt212-checkbox",{name:"tos",value:"1",class:"tos"}),i("button",{type:"button",class:"button-reset tos-view",onClick:()=>p.bookingTOS()},"View"))),i("div",{class:"input"},i("button",{type:"submit",class:"button button-dark block active"},"Proceed to payment gateway"))),this.submitted?i("div",{class:"thank-you-msg flex-vertical-center text-center"},i("div",null,i("p",null,"Your payment has been processed successfully! ",i("br",null),i("br",null),"We are now processing your booking and will email you shortly with the next steps."),i("ion-icon",{name:"md-checkmark"}))):null)}static get style(){return".booking-form-component .title{font-size:14px;font-weight:600}.booking-form-component button{border-radius:6px;font-size:12px}.booking-form-component button:focus{outline:none}.booking-form-component .form-content.submitted{visibility:hidden}.booking-form-component .payment-method{padding-top:16px;display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center}.booking-form-component .payment-method>div:not(:first-child){margin-left:12px}.booking-form-component .payment-method .subtext{padding-top:5px;font-size:8px;font-weight:600}.booking-form-component .button-toggles button{display:-ms-inline-flexbox;display:inline-flex;-ms-flex-pack:center;justify-content:center;-ms-flex-align:center;align-items:center;border:1px solid #000;height:44px;background-color:#fff;color:#000;width:123px;padding:0}\@media (min-width:1200px){.booking-form-component .button-toggles button{width:157px;font-size:14px}}.booking-form-component .button-toggles button.active{background-color:#000;color:#fff}.booking-form-component .payment-method-icon{display:inline-block;width:16px;margin-right:8px}.booking-form-component .agent button{height:32px;width:auto;padding:0;width:50%}.booking-form-component .agent button:first-child{border-top-right-radius:0;border-bottom-right-radius:0}.booking-form-component .agent button:last-child{border-top-left-radius:0;border-bottom-left-radius:0}.booking-form-component label{font-size:10px;opacity:.8;font-weight:600;display:block;padding-bottom:6px}.booking-form-component label.inline{display:inline}.booking-form-component .error label{color:red}.booking-form-component .stripe-input,.booking-form-component input,.booking-form-component input[type=email],.booking-form-component input[type=number],.booking-form-component select{height:32px;border-radius:6px;border:1px solid rgba(0,0,0,.5);background-color:#fff;width:100%}.booking-form-component .error .stripe-input,.booking-form-component .error input,.booking-form-component .error input[type=email],.booking-form-component .error input[type=number],.booking-form-component .error select{border:1px solid red}.booking-form-component .columns{display:grid;grid-template-columns:repeat(2,1fr)}.booking-form-component .columns>:nth-child(odd){margin-right:5px}.booking-form-component .columns>:nth-child(2n){margin-left:5px}.booking-form-component .tos{display:inline-block;margin-left:10px;padding-bottom:3px;--apt212-checkbox-border:1px solid #000;--apt212-checkbox-border-radius:2px}.booking-form-component .tos label{padding:0}.booking-form-component .error .tos{--apt212-checkbox-border:1px solid red}.booking-form-component .tos-view{font-size:10px;text-decoration:underline;font-weight:700}.booking-form-component .stripe-input{padding-top:6px;padding-left:4px}.booking-form-component .credit-inputs{display:none}.booking-form-component .credit-inputs.visible{display:block}.booking-form-component .thank-you-msg{position:absolute;top:0;left:0;width:100%;height:100%;-ms-flex-pack:center;justify-content:center}.booking-form-component .thank-you-msg p{font-size:24px;font-weight:700;line-height:1.5;padding:0 40px}.booking-form-component .thank-you-msg ion-icon{font-size:120px;color:#057365}.booking-form-component .tos-view{padding-bottom:6px}.booking-form-component .main-content{position:relative}.booking-form-component .main-content.hide{visibility:hidden}"}};export{b as booking_form};