import{r as t,c as s,h as e}from"./p-f5b6b644.js";import"./p-19ec51eb.js";import"./p-811a61b7.js";import{a as n}from"./p-5444f5ad.js";import{R as i}from"./p-9d127c97.js";import{T as a}from"./p-2c007f74.js";import{A as o}from"./p-5908b5da.js";import{s as r}from"./p-4c12f224.js";import{A as l}from"./p-ecdfa480.js";const c=class{constructor(e){t(this,e),this.isAdmin=!1,this.isLoggedIn=!1,this.pageSize=40,this.loaded=!1,this.agents=[],this.resultCount=0,this.store=s(this,"store")}componentWillLoad(){this.store.mapStateToProps(this,t=>({isLoggedIn:n.isLoggedIn(t),isAdmin:n.isAdmin(t),screenHeight:r.getHeight(t)})),this.isLoggedIn?this.isAdmin||i.forward("/"):i.forward("/login")}componentDidLoad(){this.renderAgents()}componentDidRender(){requestAnimationFrame(()=>{this.agentsWrapper&&(this.agentsWrapper.style.maxHeight=this.getTableHeight())})}async renderAgents(){try{const t=await this.fetchAgents();this.agents=t,this.resultCount=t.total,this.loaded=!0}catch(t){a.error(t.message)}}async fetchAgents(){try{return await o.getAgents()}catch(t){return a.error(`Could not retrieve agents: ${t.message}`)}}getTableHeight(){return this.agentsWrapper?`${this.screenHeight-this.agentsWrapper.offsetTop-150}px`:"500px"}goTo(t){i.forward(t)}async deleteAgent(t){try{if(!await l.confirm("Deleting this is a permanent action, are you sure you want to delete the agent?","Are you sure?"))return;const s=await o.deleteAgent(t);if(s.success){const s=this.agents.filter(s=>s.id!==t);this.agents=s,a.success("Agent has been deleted")}else{if(s.errors)return void a.error(s.errors.join("\n"));s.message&&a.error(s.message)}}catch(t){a.error(t.message)}}render(){return[e("admin-header",null),e("ion-content",{class:"page-admin-agents"},e("h2",{class:"text-center"},"Agents"),e("section",{class:"section full"},e("div",{class:"listings-totals text-right"},e("button",{type:"button",class:"button-dark add-new","aria-label":"Add New",onClick:()=>this.goTo("/admin/agent/")},e("ion-icon",{name:"add-circle"}))),this.loaded?e("div",{class:"listings",style:{maxHeight:this.getTableHeight()},ref:t=>this.agentsWrapper=t},e("table",{class:"data-table"},e("thead",null,e("tr",null,e("th",null,"Agent Name"),e("th",null,"Agent Email"),e("th",null,"Action"))),e("tbody",null,this.agents.map(t=>e("tr",null,e("td",null,t.name),e("td",null,t.email),e("td",null,e("button",{class:"button-dark",onClick:()=>this.deleteAgent(t.id)},e("ion-icon",{name:"trash"})),e("button",{class:"button-dark",onClick:()=>this.goTo(`/admin/agent/${t.id}`)},e("ion-icon",{name:"settings"})))))))):e("div",{class:"text-center"},e("ion-spinner",{name:"lines"}))))]}static get style(){return".page-admin-agents .listings{margin-top:32px;padding-bottom:32px;max-height:500px;overflow:auto}.page-admin-agents .listings .data-table thead th{position:-webkit-sticky;position:sticky;top:0;background-color:#fff;white-space:nowrap;padding-right:8px;z-index:1}.page-admin-agents .listings .data-table thead th button{font-weight:inherit}.page-admin-agents .listings .data-table thead th button.desc ion-icon{-webkit-transform:rotate(180deg);transform:rotate(180deg)}.page-admin-agents .listings .data-table thead th ion-icon{font-size:12px;margin-left:4px}.page-admin-agents .listings .data-table td{white-space:nowrap;border-left:1px solid #d8d8d8;background-color:#fff}.page-admin-agents button.button-dark.inactive{background-color:#888}.page-admin-agents button.button-dark.active-filter{margin-right:8px}.page-admin-agents .listings-totals{margin-top:-40px;padding-bottom:8px}.page-admin-agents .search{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center}.page-admin-agents .search .search-submit svg{width:1rem;height:1rem}.page-admin-agents .search button{height:48px}.page-admin-agents th{text-align:left;padding-left:8px;padding-bottom:10px}"}};export{c as page_admin_agents};